$(document).ready(function(){function t(t,e,a){return"undefined"==typeof e?t:a?(t+e).slice(-t.length):(e+t).substring(0,t.length)}function e(t){$('.nav-tabs a[href="#'+t+'"]').tab("show")}function a(){$("#cart tbody").children().length||$("#cart tbody").append("<td data-title='Remarks' colspan='3' id='noitem' style='padding-top:10px;' ><span class='text-danger'>NO ITEMS IN CART</span></td>")}function o(){$("#noitem").remove()}function l(){var t=[];$("#cart > tbody  > tr ").each(function(){t.push(replaceAll($(this).children().eq(4).text(),",",""))});for(var e=0,a=1.12,o=0,l=0;l<t.length;l++)e+=parseFloat(t[l]);o=e/a,a=parseFloat(e)-parseFloat(o),o=o.toFixed(2),a=a.toFixed(2),e=e.toFixed(2),$("#subtotalholder").empty(),$("#vatholder").empty(),$("#grandtotalholder").empty(),$("#changeholder").empty(),$("#cashreceiveholder").empty(),$("#changeholder").append(0),$("#cashreceiveholder").append(0),$("#subtotalholder").append(number_format(o,2)),$("#vatholder").append(number_format(a,2)),$("#grandtotalholder").append(number_format(e,2)),B()}function n(){localStorage.terminal_id&&$.ajax({url:"../ajax/ajax_get_branchAndTerminal.php",type:"POST",dataType:"json",data:{terminal_id:localStorage.terminal_id,type:7,invoice:localStorage.invoice,dr:localStorage.dr,ir:localStorage.ir},success:function(t){t.msg&&(alertify.alert(t.msg),t.next.invoice&&(localStorage.invoice=t.next.invoice,R()),t.next.dr&&(localStorage.dr=t.next.dr,G()),t.next.ir&&(localStorage.ir=t.next.ir,W()))}})}function i(){localStorage.company_id&&$.ajax({url:"../ajax/ajax_query.php",type:"POST",data:{cid:localStorage.company_id,functionName:"getDocumentLayout"},success:function(t){var e=JSON.parse(t);localStorage.invoice_format=e.invoice,localStorage.dr_format=e.dr,localStorage.ir_format=e.ir,localStorage.news_format=e.extra}})}function r(t){null!=localStorage.terminal_id&&$.ajax({url:"../ajax/ajax_get_branchAndTerminal.php",type:"POST",data:{cid:t,type:3},success:function(t){var e=t.split(":");localStorage.invoice=e[0],localStorage.end_invoice=e[1],localStorage.dr=e[2],localStorage.end_dr=e[3],localStorage.invoice_limit=e[4],localStorage.dr_limit=e[5],localStorage.ir=e[6],localStorage.end_ir=e[7],localStorage.ir_limit=e[8],localStorage.speed_opt=e[9],localStorage.use_printer=e[10],localStorage.data_sync=e[11],localStorage.news_print=e[12],localStorage.print_inv=e[13],localStorage.print_dr=e[14],localStorage.print_ir=e[15],localStorage.pref_inv=e[16],localStorage.pref_dr=e[17],localStorage.pref_ir=e[18],R(),G(),W(),n()}})}function s(t,e){$("#con_member").empty(),$("#con_member").append("<option></option>"),$("#con_member_freebies").empty(),$("#con_member_freebies").append("<option></option>"),$("#member_credit").empty(),$("#member_credit").append("<option></option>"),$("#member_deduction").empty(),$("#member_deduction").append("<option></option>"),e&&$.ajax({url:"../ajax/ajax_get_members.php",type:"POST",data:{company_id:t,member_id:e,type:1},success:function(t){if(0!=t){var a=JSON.parse(t);for(var o in a){var l=0,n=0;if(a[o].amt){var i=0;l=a[o].amt,a[o].camt&&(i=a[o].camt),l-=i,$("#con_member").append("<option data-con='"+l+"' value='"+a[o].id+"'>"+a[o].lastname+", "+a[o].firstname+" "+a[o].middlename+" ("+l+")</option>")}a[o].freebiesamount&&(n=a[o].freebiesamount),$("#con_member_freebies").append("<option data-con_freebies='"+n+"' value='"+a[o].id+"'>"+a[o].lastname+", "+a[o].firstname+" "+a[o].middlename+" ("+n+")</option>"),$("#member_credit").append("<option value='"+a[o].id+"'>"+a[o].lastname+", "+a[o].firstname+" "+a[o].middlename+"</option>"),$("#member_deduction").append("<option value='"+a[o].id+"'>"+a[o].lastname+", "+a[o].firstname+" "+a[o].middlename+"</option>")}$("#con_member_freebies").select2("val",e),$("#member_credit").select2("val",e),$("#con_member").select2("val",e),$("#member_deduction").select2("val",e),$("#con_member_freebies").attr("disabled",!0),$("#member_credit").attr("disabled",!0),$("#member_deduction").attr("disabled",!0),$("#con_member").attr("disabled",!0)}}})}function d(){var t=$("#hidcashpayment").val();t||(t=0);var e=$("#hidcreditpayment").val();e||(e=0);var a=$("#hidbanktransferpayment").val();a||(a=0);var o=$("#hidchequepayment").val();o||(o=0);var l=$("#hidconsumablepayment").val();l||(l=0);var n=$("#hidconsumablepaymentfreebies").val();n||(n=0);var i=$("#hidmembercredit").val();i||(i=0);var r=$("#hidmemberdeduction").val();r||(r=0);var s=$("#member_credit_cod").is(":checked");s=s?1:0;var d=parseFloat(t)+parseFloat(e)+parseFloat(a)+parseFloat(o)+parseFloat(l)+parseFloat(n)+parseFloat(i)+parseFloat(r),m=parseFloat($("#hidamountdue").val());if(parseFloat(d)<0||parseFloat(d)<parseFloat(m))return p(0,0),void showToast("error","<p>Invalid payment</p>","<h3>WARNING!</h3>","toast-bottom-right");if(N()&&k()&&I()){var c=parseFloat(d)-parseFloat(m);t=parseFloat(t)-parseFloat(c),localStorage.payment_cash=t,localStorage.payment_con=l,localStorage.payment_con_freebies=n,localStorage.payment_member_credit=i,localStorage.payment_member_deduction=r;var h,b,v,f,_,y,u,g;$("#payment_order_id").val();localStorage.payment_cash&&(f=localStorage.payment_cash),localStorage.payment_con&&(y=localStorage.payment_con),localStorage.payment_con_freebies&&(_=localStorage.payment_con_freebies),localStorage.payment_member_credit&&(u=localStorage.payment_member_credit),localStorage.payment_member_deduction&&(g=localStorage.payment_member_deduction),localStorage.payment_credit&&(h=localStorage.payment_credit),localStorage.payment_bt&&(b=localStorage.payment_bt),localStorage.payment_cheque&&(v=localStorage.payment_cheque),p(d,c),$("#credit_table").find("tr").remove(),$("#bt_table").find("tr").remove(),$("#ch_table").find("tr").remove(),$("#tab_d :input[type='text']").val(""),$("#tab_c :input[type='text']").val(""),$("#tab_b :input[type='text']").val(""),$("#tab_a :input[type='text']").val(""),$("#getpricemodal").modal("hide")}}function p(t,e){$("#cashreceiveholder").empty(),$("#changeholder").empty(),$("#cashreceiveholder").append(number_format(t,2)),$("#changeholder").append(number_format(e,2))}function m(){var t=$("#cashreceivetext").val();t||(t=0);var e=$("#con_amount").val();e||(e=0);var a=$("#con_amount_freebies").val();a||(a=0);var o=$("#member_credit_amount").val();o||(o=0);var l=$("#member_deduction_amount").val();l||(l=0);var n=$("#hidcreditpayment").val();n||(n=0);var i=$("#hidbanktransferpayment").val();i||(i=0);var r=$("#hidchequepayment").val();r||(r=0);var s=parseFloat(t)+parseFloat(e)+parseFloat(a)+parseFloat(o)+parseFloat(n)+parseFloat(i)+parseFloat(r)+parseFloat(l);$("#totalOfAllPayment").html("<strong><span style='font-size:1.2em;' class='text-info' >Total Payment: "+s.toFixed(2)+"</span></strong>")}function c(){var t=$("#cashreceivetext").val();t||(t=0),$("#totalcashpayment").html(t),m()}function h(){var t=$("#con_amount").val();t||(t=0),$("#totalconsumablepayment").html(t),m()}function b(){var t=$("#member_credit_amount").val();t||(t=0),$("#totalmembercredit").html(t),m()}function v(){var t=$("#member_deduction_amount").val();t||(t=0),$("#totalmemberdeduction").html(t),m()}function f(){var t=$("#con_amount_freebies").val();t||(t=0),$("#totalconsumablepaymentfreebies").html(t),m()}function _(){var t=0;$("#credit_table tr").children().length&&$("#credit_table tr").each(function(e){var a=$(this),o=a.children().eq(1).text();t=parseFloat(t)+parseFloat(o)}),$("#totalcreditpayment").html(t),$("#hidcreditpayment").val(t),m()}function y(){var t=0;$("#bt_table tr").children().length&&$("#bt_table tr").each(function(e){var a=$(this),o=a.children().eq(1).text();t=parseFloat(t)+parseFloat(o)}),$("#totalbanktransferpayment").html(t),$("#hidbanktransferpayment").val(t),m()}function u(){var t=0;$("#ch_table tr").children().length&&$("#ch_table tr").each(function(e){var a=$(this),o=a.children().eq(2).text();t=parseFloat(t)+parseFloat(o)}),$("#totalchequepayment").html(t),$("#hidchequepayment").val(t),m()}function g(t){$("#credit_table tr").children().length||(showToast("error","<p>Please Add Credit Card First. </p>","<h3>WARNING!</h3>","toast-bottom-right"),t.val(""))}function x(t){$("#bt_table tr").children().length||(showToast("error","<p>Please Add Bank Transfer Data First. </p>","<h3>WARNING!</h3>","toast-bottom-right"),t.val(""))}function w(t){$("#ch_table tr").children().length||(showToast("error","<p>Please Add Cheque Data First. </p>","<h3>WARNING!</h3>","toast-bottom-right"),t.val(""))}function S(t,e){var a=$("#hidcashpayment").val();a||(a=0);var o=$("#hidcreditpayment").val();o||(o=0);var l=$("#hidbanktransferpayment").val();l||(l=0);var n=$("#hidchequepayment").val();n||(n=0);var i=$("#hidconsumablepayment").val();i||(i=0);var r=$("#hidconsumablepaymentfreebies").val();r||(r=0);var s=$("#hidmembercredit").val();s||(s=0);var d=$("#hidmemberdeduction").val();d||(d=0);var p=parseFloat($("#hidamountdue").val()),m=parseFloat(o)+parseFloat(l)+parseFloat(n)+parseFloat(i)+parseFloat(r)+parseFloat(s)+parseFloat(d);return e&&(m=parseFloat(m)+parseFloat(t)),parseFloat(m).toFixed(2)>parseFloat(p)?!0:!1}function N(){if($("#ch_table tr").children().length){var t=new Array,e=$("#ch_firstname").val(),a=$("#ch_middlename").val(),o=$("#ch_lastname").val(),l=$("#ch_phone").val();return e&&!F(e)?(showToast("error","<p>First name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):a&&!F(a)?(showToast("error","<p>Middle name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):o&&!F(o)?(showToast("error","<p>Last name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):l&&!F(l)?(showToast("error","<p>Phone should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):($("#ch_table tr").each(function(n){var i=$(this);t[n]={date:i.children().eq(0).text(),cheque_number:i.children().eq(1).text(),amount:i.children().eq(2).text(),bank_name:i.children().eq(3).text(),firstname:e,lastname:o,middlename:a,phone:l}}),localStorage.payment_cheque=JSON.stringify(t),!0)}return!0}function k(){if($("#credit_table tr").children().length){var t=new Array,e=$("#billing_firstname").val(),a=$("#billing_middlename").val(),o=$("#billing_lastname").val(),l=$("#billing_company").val(),n=$("#billing_address").val(),i=$("#billing_postal").val(),r=$("#billing_phone").val(),s=$("#billing_email").val(),d=$("#billing_remarks").val(),p=$("#billing_card_type").val(),m=$("#billing_trace_number").val(),c=$("#billing_approval_code").val(),h=$("#billing_date").val();return p&&m&&c&&h?o&&!F(o)?(showToast("error","<p>Last name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):e&&!F(e)?(showToast("error","<p>First name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):a&&!F(a)?(showToast("error","<p>Middle name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):l&&!F(l)?(showToast("error","<p>Company should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):n&&!F(n)?(showToast("error","<p>Address should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):i&&!z(i)?(showToast("error","<p>Postal should be numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):r&&!F(r)?(showToast("error","<p>Phone should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):s&&!T(s)?(showToast("error","<p>Email should be valid email address</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):d&&!F(d)?(showToast("error","<p>Remarks should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):($("#credit_table tr").each(function(b){var v=$(this);t[b]={credit_number:v.children().eq(0).text(),amount:v.children().eq(1).text(),bank_name:v.children().eq(2).text(),firstname:e,lastname:o,middlename:a,phone:r,comp:l,add:n,postal:i,email:s,remarks:d,card_type:p,trace_number:m,approval_code:c,date:h}}),localStorage.payment_credit=JSON.stringify(t),!0):(showToast("error","<p>Please Complete Credit Card billing form. </p>","<h3>WARNING!</h3>","toast-bottom-right"),!1)}return!0}function I(){if($("#bt_table tr").children().length){var t=new Array,e=$("#bt_bankto_name").val(),a=$("#bt_bankto_account_number").val(),o=$("#bt_firstname").val(),l=$("#bt_middlename").val(),n=$("#bt_lastname").val(),i=$("#bt_company").val(),r=$("#bt_address").val(),s=$("#bt_postal").val(),d=$("#bt_phone").val(),p=$("#bt_date").val();return p?e&&!F(e)?(showToast("error","<p>Bank name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):a&&!F(a)?(showToast("error","<p>Bank account number should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):o&&!F(o)?(showToast("error","<p>First name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):l&!F(l)?(showToast("error","<p>Middle name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):n&&!F(n)?(showToast("error","<p>Last name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):i&&!F(i)?(showToast("error","<p>Company should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):r&&!F(r)?(showToast("error","<p>Address should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):s&&!z(s)?(showToast("error","<p>Phone should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):d&&!F(d)?(showToast("error","<p>Phone should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):($("#bt_table tr").each(function(m){var c=$(this);t[m]={credit_number:c.children().eq(0).text(),amount:c.children().eq(1).text(),bank_name:c.children().eq(2).text(),bt_bankto_name:e,bt_bankto_account_number:a,firstname:o,lastname:n,middlename:l,phone:d,comp:i,add:r,postal:s,date:p}}),localStorage.payment_bt=JSON.stringify(t),!0):(showToast("error","<p>Please Bank Transfer  billing form. </p>","<h3>WARNING!</h3>","toast-bottom-right"),!1)}return!0}function F(t){var e=/^[\w\-\s\.,??]+$/;return e.test(t)?!0:!1}function A(t){var e=/^(0[1-9]|1[0-2])\/(0[1-9]|1\d|2\d|3[01])\/(19|20)\d{2}$/;return e.test(t)}function z(t){var e=/^[0-9]+$/;return e.test(t)?!0:!1}function T(t){var e=/^[\w\.-_\+]+@[\w-]+(\.\w{2,3})+$/;return e.test(t)?!0:!1}function q(t,a){var o;try{o=JSON.parse($("#op_member_list").val()),o.length>0&&$("#use_user_overpayment").show()}catch(l){console.log("No over payment")}t?localStorage.totalforfreebies=t:localStorage.totalforfreebies=0,localStorage.removeItem("payment_cheque"),localStorage.removeItem("payment_credit"),localStorage.removeItem("payment_bt"),localStorage.removeItem("payment_cash"),localStorage.removeItem("payment_con"),localStorage.removeItem("payment_con_freebies"),localStorage.removeItem("payment_member_credit"),$("#cashreceiveholder").text(0),$("#changeholder").text(0),$("#con_amount_freebies").val(""),$("#con_amount").val(""),$("#member_credit_amount").val(""),_(),c(),y(),u(),h(),f(),b(),v(),$("#amountdue").html("<span style='font-size:1.2em;' class='text-info'><strong> Amount Due: "+a+"</strong></span>"),$("#hidamountdue").val(replaceAll(a,",",""));try{var n=JSON.parse($("#mem_data").val());1==n.is_blacklisted?$(".notcashlist").hide():$(".notcashlist").show()}catch(l){}$("#getpricemodal").modal("show"),setTimeout(function(){$("#withConsumableAmount").length?(e("tab_e"),$("#con_amount").focus()):$("#cashreceivetext").focus()},500)}function p(t,e){$("#cashreceiveholder").empty(),$("#changeholder").empty(),$("#cashreceiveholder").append(number_format(t,2)),$("#changeholder").append(number_format(e,2))}function R(){var t=parseInt(localStorage.invoice)+1,e="<span style='color:#000;'>Next "+st+": </span> "+t;$("#nextInvoicenumber").html(e)}function G(){var t=parseInt(localStorage.dr)+1,e="<span style='color:#000;'>Next "+dt+": </span> "+t;$("#nextDrnumber").html(e)}function W(){var t=parseInt(localStorage.ir)+1,e="<span style='color:#000;'>Next "+pt+": </span> "+t;$("#nextIrnumber").html(e)}function P(){var t=$("#member_id").val(),e=$("#agent_id").val(),a=$("#sales_type").val(),o=$("#remarks").val(),l=$("#sales_po_number").val(),n=$("#custom_date_sold").val(),i=[],r=L();$("input[name='checkType']:checked").each(function(){i.push($(this).val())}),i.length||showToast("error","<p>Please select receipt type.</p>","<h3>WARNING!</h3>","toast-bottom-right");var s=localStorage.invoice_limit,d=localStorage.dr_limit,p=localStorage.ir_limit,m=($("#cart tbody tr").length,$("#custom_invoice").val()),c=$("#custom_dr").val(),h=$("#custom_ir").val();if($("#cart > tbody > #noitem").children().length)showToast("error","<p>no items in cart</p>","<h3>WARNING!</h3>","toast-bottom-right");else{var b=0,v=0,f=0;for(var _ in i)1==i[_]&&(b=parseInt(localStorage.invoice)+1,s=parseInt(s)+1),2==i[_]&&(v=parseInt(localStorage.dr)+1,d=parseInt(d)+1),3==i[_]&&(f=parseInt(localStorage.ir)+1,p=parseInt(p)+1);var y=1,u=[],g="",x="",w="",S="",N="",k="",I="",F="";localStorage.payment_cash&&(S=localStorage.payment_cash),localStorage.payment_con&&(N=localStorage.payment_con),localStorage.payment_con_freebies&&(k=localStorage.payment_con_freebies),localStorage.payment_member_credit&&(I=localStorage.payment_member_credit),localStorage.payment_member_deduction&&(F=localStorage.payment_member_deduction),localStorage.payment_credit&&(g=localStorage.payment_credit),localStorage.payment_bt&&(x=localStorage.payment_bt),localStorage.payment_cheque&&(w=localStorage.payment_cheque);var A="",z="",T="",q="";localStorage.op_payment_credit&&(A=localStorage.op_payment_credit),localStorage.op_payment_bt&&(z=localStorage.op_payment_bt),localStorage.op_payment_cheque&&(T=localStorage.op_payment_cheque),localStorage.op_payment_cash&&(q=localStorage.op_payment_cash);var R=[];if($("input:checkbox.chk_overpayment").each(function(){var t=$(this);t.is(":checked")&&R.push(t.val())}),$("#cart >tbody > tr").each(function(l){var n=$(this),r=n.attr("data-item_id"),_=0;-1!=i.indexOf("1")&&y%s==0&&(b=parseInt(b)+1),-1!=i.indexOf("2")&&y%d==0&&(v=parseInt(v)+1),-1!=i.indexOf("3")&&y%p==0&&(f=parseInt(f)+1),y=parseInt(y)+1;var g=0,x=n.attr("data-price_adjustment"),w=n.attr("data-member_adjustment");g=g?g:0,x=x?x:0,w=w?w:0,x=parseFloat(x)*parseFloat(n.children().eq(1).text());var S=Date.now()/1e3;b=m?m:b,v=c?c:v,f=h?h:f,u.push({item_id:r,qty:n.children().eq(1).text(),barcode:n.attr("data-barcode"),is_bundle:n.attr("data-is_bundle"),price:n.children().eq(2).text(),price_id:n.children().eq(2).prop("id"),discount:0,store_discount:g,adjustment:x,member_adjustment:w,total:n.children().eq(4).text(),company_id:localStorage.company_id,sold_date:S,invoice:b,dr:v,ir:f,mem_id:t,remarks:o,warranty:_,agent_id:e,sales_type:a})}),u.length>0){var G="";$("#service_used_items").length>0&&(G=$("#service_used_items").val());var W=localStorage.pref_inv?localStorage.pref_inv:"",P=localStorage.pref_dr?localStorage.pref_dr:"",j=localStorage.pref_ir?localStorage.pref_ir:"",O=$("#member_deduction_remarks").val();$.ajax({url:"../ajax/ajax_query2.php",type:"POST",data:{functionName:"sendPOSSale",items:JSON.stringify(u),terminal_id:localStorage.terminal_id,branch_id:localStorage.branch_id,payment_credit:g,payment_bt:x,payment_cheque:w,payment_cash:S,payment_con:N,payment_con_freebies:k,payment_member_credit:I,payment_member_deduction:F,member_deduction_remarks:O,member_id:t,remarks:o,sales_po_number:l,service_used_items:G,arr_points:r,pref_inv:W,pref_dr:P,pref_ir:j,custom_date_sold:n,op_payment_credit:A,op_payment_bt:z,op_payment_cheque:T,op_payment_cash:q,arr_op_ids:JSON.stringify(R)},success:function(t){location.reload()},error:function(){alert("Error Occur")}})}}}function j(t,e,a,o){for(var l in t)1==t[l]&&O(e),2==t[l]&&C(a),3==t[l]&&J(o)}function O(e){if(0==localStorage.print_inv)return!0;var a,o=$("#member_id"),l="",n=JSON.parse(localStorage.invoice_format);o.val()&&(l=$("#member_id").select2("data").text,a=l.split(","),l=a[0]);var i="";localStorage.members&&(i=JSON.parse(localStorage.members));var r=$("#remarks").val(),s="",d="",p=($("#opt_station"),"");if(i)for(var m in i){var c=i[m];c.id==o.val()&&(s=c.personal_address+"<br>Contact Person: "+c.firstname+" "+c.lastname+"<br>Contact #: "+c.contact_number)}var h=Date.now()/1e3,b=new Date(1e3*h),v=b.getMonth()+1,f=b.getDate(),_=(10>v?"0":"")+v+"/"+(10>f?"0":"")+f+"/"+b.getFullYear(),y=$("#custom_date_sold").val();y&&(_=y);var u="",g=n.date.visible?"display:block;":"display:none;",x=n.membername.visible?"display:block;":"display:none;",w=n.memberaddress.visible?"display:block;":"display:none;",S=n.stationname.visible?"display:block;":"display:none;",N=n.stationaddress.visible?"display:block;":"display:none;",k=n.itemtable.visible?"display:block;":"display:none;",I=n.payments.visible?"display:block;":"display:none;",F=n.payments2.visible?"display:block;":"display:none;",A=n.payments3.visible?"display:block;":"display:none;",z=n.cashier.visible?"display:block;":"display:none;",T=n.remarks.visible?"display:block;":"display:none;",q=n.reserved.visible?"display:block;":"display:none;",R=n.drnum.visible?"display:block;":"display:none;",G=n.tdbarcode.visible?"display:inline-block;":"display:none;",W=n.tdqty.visible?"display:inline-block;":"display:none;",P=n.tddescription.visible?"display:inline-block;":"display:none;",j=n.tdprice.visible?"display:inline-block;":"display:none;",O=n.tdtotal.visible?"display:inline-block;":"display:none;",C=n.date.bold?"font-weight:bold;":"font-weight:normal;",J=n.membername.bold?"font-weight:bold;":"font-weight:normal;",D=n.memberaddress.bold?"font-weight:bold;":"font-weight:normal;",E=n.stationname.bold?"font-weight:bold;":"font-weight:normal;",L=n.stationaddress.bold?"font-weight:bold;":"font-weight:normal;",Y=n.itemtable.bold?"font-weight:bold;":"font-weight:normal;",B=n.payments.bold?"font-weight:bold;":"font-weight:normal;",V=n.payments2.bold?"font-weight:bold;":"font-weight:normal;",H=n.payments3.bold?"font-weight:bold;":"font-weight:normal;",U=n.cashier.bold?"font-weight:bold;":"font-weight:normal;",Z=n.remarks.bold?"font-weight:bold;":"font-weight:normal;",Q=n.reserved.bold?"font-weight:bold;":"font-weight:normal;",K=n.drnum.bold?"font-weight:bold;":"font-weight:normal;",X=n.tdbarcode.bold?"font-weight:bold;":"font-weight:normal;",tt=n.tdqty.bold?"font-weight:bold;":"font-weight:normal;",et=n.tddescription.bold?"font-weight:bold;":"font-weight:normal;",at=n.tdprice.bold?"font-weight:bold;":"font-weight:normal;",ot=n.tdtotal.bold?"font-weight:bold;":"font-weight:normal;";u+="<div id='maindivforprinting' style='page-break-before: always;position:relative;'>",u=u+"<div style='"+g+C+"position:absolute;top:"+n.date.top+"px; left:"+n.date.left+"px;font-size:"+n.date.fontSize+"px;'> <br/><br/>"+_+" </div><div style='clear:both;'></div>",u=u+"<div style='"+x+J+"position:absolute;top:"+n.membername.top+"px; left:"+n.membername.left+"px;font-size:"+n.membername.fontSize+"px;'>"+l+"</div>",u=u+"<div style='"+w+D+"position:absolute;top:"+n.memberaddress.top+"px; left:"+n.memberaddress.left+"px;width:"+n.memberaddress.width+"px;font-size:"+n.memberaddress.fontSize+"px;'>"+s+"</div>",u=u+"<div style='"+S+E+"position:absolute;top:"+n.stationname.top+"px; left:"+n.stationname.left+"px;font-size:"+n.stationname.fontSize+"px;'>"+p+"</div>",u=u+"<div style='"+N+L+"position:absolute;top:"+n.stationaddress.top+"px; left:"+n.stationaddress.left+"px;width:"+n.stationaddress.width+"px;font-size:"+n.stationaddress.fontSize+"px;'>"+d+"</div>",u=u+"<table id='itemscon' style='"+k+Y+"position:absolute;top:"+n.itemtable.top+"px;left:"+n.itemtable.left+"px;font-size:"+n.itemtable.fontSize+"px;'> &nbps;";var lt=($("#cart > tbody > tr").length,localStorage.invoice_limit),nt=(localStorage.dr_limit,[]),it=1,rt=1,st=0,dt=1.12;lt=parseInt(lt)+1;var pt="";if($("#cart > tbody > tr").each(function(t){var e=$(this),a=e.attr("data-itemcode"),o=e.attr("data-desc"),l=(e.attr("data-barcode"),e.attr("data-unit_name"));l=l?l:"";var i=e.children().eq(1).text()+"<span style='margin-left:50px;'>"+l+"</span>",r=e.children().eq(2).text(),s=(e.children().eq(3).text(),replaceAll(e.children().eq(4).text(),",","")),d=parseFloat(i)*parseFloat(r),p=e.children().eq(3).text();if(0!=parseFloat(p))var m="",c="<br/>("+number_format(p,2)+")";else var m="",c="";if(rt%lt==0){var h=st/dt,b=parseFloat(st)-parseFloat(h);h=h.toFixed(2),b=b.toFixed(2),st=st.toFixed(2),nt[it]=nt[it]+"</table>",nt[it]=nt[it]+"<div style='"+I+B+"position:absolute; list-style-type: none; left:"+n.payments.left+"px;top:"+n.payments.top+"px;font-size:"+n.payments.fontSize+"px;'>"+h+"</div>",nt[it]=nt[it]+"<div style='"+F+V+"position:absolute; list-style-type: none; left:"+n.payments2.left+"px;top:"+n.payments2.top+"px;font-size:"+n.payments2.fontSize+"px;'>"+b+"</div>",nt[it]=nt[it]+"<div style='"+A+H+"position:absolute; list-style-type: none; left:"+n.payments3.left+"px;top:"+n.payments3.top+"px;font-size:"+n.payments3.fontSize+"px;'>"+st+"</div>",it=parseInt(it)+1,st=0}st=parseFloat(st)+parseFloat(s),nt[it]||(nt[it]=""),nt[it]=nt[it]+"<tr ><td style='"+G+X+"position:relative;width:"+n.tdbarcode.width+"px;padding-left:"+n.tdbarcode.left+"px;'>"+a+"</td><td style='"+W+tt+"position:relative;width:"+n.tdqty.width+"px;padding-left:"+n.tdqty.left+"px;'>"+i+"</td><td style='"+P+et+"position:relative;width:"+n.tddescription.width+"px;padding-left:"+n.tddescription.left+"px;'> "+o+" <span style='padding-left:20px;'>"+m+"</span> </td><td style='"+j+at+"position:relative;width:"+n.tdprice.width+"px;padding-left:"+n.tdprice.left+"px;'>"+number_format(r,2)+"</td><td style='"+O+ot+"position:relative;width:"+n.tdtotal.width+"px;padding-left:"+n.tdtotal.left+"px;'>"+number_format(d,2)+" "+c+"</td></tr>",rt=parseInt(rt)+1}),st>0){var mt=$("#hidconsumablepayment").val();mt>0&&(st-=mt);var ct=st/dt,ht=parseFloat(st)-parseFloat(ct);ct=ct.toFixed(2),ht=ht.toFixed(2),st=st.toFixed(2),nt[it]||(nt[it]=""),nt[it]=nt[it]+"</table>",mt>0&&(nt[it]=nt[it]+"<div style='"+I+B+"position:absolute; list-style-type: none; left:"+n.payments.left+"px;top:"+(n.payments.top-12)+"px;font-size:"+n.payments.fontSize+"px;'>("+mt+")</div>"),nt[it]=nt[it]+"<div style='"+I+B+"position:absolute; list-style-type: none; left:"+n.payments.left+"px;top:"+n.payments.top+"px;font-size:"+n.payments.fontSize+"px;'>"+ct+"</div>",nt[it]=nt[it]+"<div style='"+F+V+"position:absolute; list-style-type: none; left:"+n.payments2.left+"px;top:"+n.payments2.top+"px;font-size:"+n.payments2.fontSize+"px;'>"+ht+"</div>",nt[it]=nt[it]+"<div style='"+A+H+"position:absolute; list-style-type: none; left:"+n.payments3.left+"px;top:"+n.payments3.top+"px;font-size:"+n.payments3.fontSize+"px;'>"+st+"</div>"}var bt="";pt||(pt="");var vt=$("#agent_id"),ft="";vt.val()&&(ft=vt.select2("data").text),pt=ft;var _t=$("#custom_invoice").val(),yt=parseInt(localStorage.invoice)+1,ut=_t?_t:yt,gt=ut;r||(r="");var $t=localStorage.pref_inv?localStorage.pref_inv:"";gt=t("000000",gt,!0),gt=$t+gt,bt=bt+"<div style='"+z+U+"position:absolute;left:"+n.cashier.left+"px;top:"+n.cashier.top+"px;font-size:"+n.cashier.fontSize+"px;'>"+localStorage.current_lastname+", "+localStorage.current_firstname+"</div>",bt=bt+"<div style='"+T+Z+"position:absolute;left:"+n.remarks.left+"px;top:"+n.remarks.top+"px;font-size:"+n.remarks.fontSize+"px;'>"+r+"</div>",bt=bt+"<div style='"+q+Q+"position:absolute;left:"+n.reserved.left+"px;top:"+n.reserved.top+"px;font-size:"+n.reserved.fontSize+"px;'>"+pt+"</div>",bt=bt+"<div style='"+R+K+"position:absolute;left:"+n.drnum.left+"px;top:"+n.drnum.top+"px;font-size:"+n.drnum.fontSize+"px;'>"+gt+"</div>";var xt="",wt="",St="",Nt=n.terms.visible?"display:inline-block;":"display:none;",kt=n.ponum.visible?"display:inline-block;":"display:none;",It=n.tin.visible?"display:inline-block;":"display:none;",Ft=n.terms.bold?"font-weight:bold;":"font-weight:normal;",At=n.ponum.bold?"font-weight:bold;":"font-weight:normal;",zt=n.tin.bold?"font-weight:bold;":"font-weight:normal;";bt=bt+"<div style='"+Nt+Ft+"position:absolute;left:"+n.terms.left+"px;top:"+n.terms.top+"px;font-size:"+n.terms.fontSize+"px;'>"+xt+"</div>",bt=bt+"<div style='"+kt+At+"position:absolute;left:"+n.ponum.left+"px;top:"+n.ponum.top+"px;font-size:"+n.ponum.fontSize+"px;'>"+wt+"</div>",bt=bt+"<div style='"+It+zt+"position:absolute;left:"+n.tin.left+"px;top:"+n.tin.top+"px;font-size:"+n.tin.fontSize+"px;'>"+St+"</div>",bt+="</div>";var Tt="";for(var m in nt)Tt=Tt+u+nt[m]+bt;Tt=replaceAll(Tt,"undefined",""),M(Tt)}function C(e){if(0==localStorage.print_dr)return!0;var a="";try{a=JSON.parse($("#mem_data").val()),1==a.is_blacklisted?$(".notcashlist").hide():$(".notcashlist").show()}catch(o){}var l,n="font-family: Arial, Helvetica, sans-serif;",i=$("#member_id"),r="",s=JSON.parse(localStorage.dr_format),d="";i.val()&&(r=$("#member_id").select2("data").text,l=r.split(","),r=l[0],d=l[1]);var p="";localStorage.members&&(p=JSON.parse(localStorage.members));var m=$("#sales_remarks").val(),c="",h="",b=$("#opt_station"),v="";if(p)for(var f in p){var _=p[f];_.id==i.val()&&(c=_.personal_address+"<br>Contact Person: "+_.firstname+" "+_.lastname+"<br>Contact #: "+_.contact_number)}i.val()&&(c=$("#member_id").select2("data").address),b.val()&&(h=$("#"+b.attr("id")+" :selected").attr("data-address"),v=$("#"+b.attr("id")+" :selected").text());var y=Date.now()/1e3,u=parseInt(localStorage.servertime)-parseInt(localStorage.localtime);y=parseInt(y)+parseInt(u);var g=new Date(1e3*y),x=g.getMonth()+1,w=g.getDate(),S=(10>x?"0":"")+x+"/"+(10>w?"0":"")+w+"/"+g.getFullYear(),N=$("#custom_date_sold").val();N&&(S=N);var k=s.date.visible?"display:block;":"display:none;",I=s.membername.visible?"display:block;":"display:none;",F=s.memberaddress.visible?"display:block;":"display:none;",A=s.stationname.visible?"display:block;":"display:none;",z=s.stationaddress.visible?"display:block;":"display:none;",T=(s.itemtable.visible?"display:block;":"display:none;",s.payments.visible?"display:block;":"display:none;"),q=s.payments2.visible?"display:block;":"display:none;",R=s.payments3.visible?"display:block;":"display:none;",G=s.cashier.visible?"display:block;":"display:none;",W=s.remarks.visible?"display:block;":"display:none;",P=s.reserved.visible?"display:block;":"display:none;",j=s.drnum.visible?"display:block;":"display:none;",O=s.tdbarcode.visible?"display:inline-block;":"display:none;",C=s.tdqty.visible?"display:inline-block;":"display:none;",J=s.tddescription.visible?"display:inline-block;":"display:none;",D=s.tdprice.visible?"display:inline-block;":"display:none;",E=s.tdtotal.visible?"display:inline-block;":"display:none;",L=s.date.bold?"font-weight:bold;":"font-weight:normal;",Y=s.membername.bold?"font-weight:bold;":"font-weight:normal;",B=s.memberaddress.bold?"font-weight:bold;":"font-weight:normal;",V=s.stationname.bold?"font-weight:bold;":"font-weight:normal;",H=s.stationaddress.bold?"font-weight:bold;":"font-weight:normal;",U=(s.itemtable.bold?"font-weight:bold;":"font-weight:normal;",s.payments.bold?"font-weight:bold;":"font-weight:normal;"),Z=s.payments2.bold?"font-weight:bold;":"font-weight:normal;",Q=s.payments3.bold?"font-weight:bold;":"font-weight:normal;",K=s.cashier.bold?"font-weight:bold;":"font-weight:normal;",X=s.remarks.bold?"font-weight:bold;":"font-weight:normal;",tt=s.reserved.bold?"font-weight:bold;":"font-weight:normal;",et=s.drnum.bold?"font-weight:bold;":"font-weight:normal;",at=s.tdbarcode.bold?"font-weight:bold;":"font-weight:normal;",ot=s.tdqty.bold?"font-weight:bold;":"font-weight:normal;",lt=s.tddescription.bold?"font-weight:bold;":"font-weight:normal;",nt=s.tdprice.bold?"font-weight:bold;":"font-weight:normal;",it=s.tdtotal.bold?"font-weight:bold;":"font-weight:normal;",rt=$("#print_copy").val();rt=rt?parseInt(rt):1;for(var st="",dt=1;rt>=dt;dt++){1==dt?(D="display:none;",E="display:none;"):(D=s.tdprice.visible?"display:inline-block;":"display:none;",E=s.tdtotal.visible?"display:inline-block;":"display:none;");
	var pt="";pt=pt+"<div id='maindivforprinting' style='page-break-before: always;position:relative;"+n+"'>&nbsp;",pt=pt+"<div style='"+k+L+"position:absolute;top:"+s.date.top+"px; left:"+s.date.left+"px;font-size:"+s.date.fontSize+"px;'><br/><br/>"+S+" </div><div style='clear:both;'></div>",pt=pt+"<div style='"+I+Y+"position:absolute;top:"+s.membername.top+"px; left:"+s.membername.left+"px;font-size:"+s.membername.fontSize+"px;'>"+r+"</div>",pt=pt+"<div style='"+F+B+"position:absolute;top:"+s.memberaddress.top+"px; left:"+s.memberaddress.left+"px;width:"+s.memberaddress.width+"px;font-size:"+s.memberaddress.fontSize+"px;'>"+c+"</div>",pt=pt+"<div style='"+A+V+"position:absolute;top:"+s.stationname.top+"px; left:"+s.stationname.left+"px;font-size:"+s.stationname.fontSize+"px;'>"+v+"</div>",pt=pt+"<div style='"+z+H+"position:absolute;top:"+s.stationaddress.top+"px; left:"+s.stationaddress.left+"px;width:"+s.stationaddress.width+"px;font-size:"+s.stationaddress.fontSize+"px;'>"+h+"</div>",pt=pt+"<table id='itemscon' style='position:absolute;top:"+s.itemtable.top+"px;left:"+s.itemtable.left+"px;font-size:"+s.itemtable.fontSize+"px;'> ";var mt=($("#cart > tbody > tr").length,localStorage.dr_limit),ct=[],ht=1,bt=1,vt=0,ft=1.12;mt=parseInt(mt)+1;var _t="";if($("#cart > tbody > tr").each(function(t){var e=$(this),o=e.attr("data-itemcode"),l=e.attr("data-desc"),n=(e.attr("data-barcode"),e.attr("data-unit_name"));n=n?n:"";var i=e.children().eq(1).text()+"<span style='margin-left:50px;'>"+n+"</span>",r=e.children().eq(2).text(),d=e.children().eq(3).find("input").val(),p=replaceAll(e.children().eq(4).text(),",",""),m=parseFloat(i)*parseFloat(r),c=e.children().eq(3).text(),h=parseFloat(e.attr("data-store_discount"));if(d=parseFloat(d)+h,_t=e.attr("data-reserved_by"),0!=parseFloat(c))var b=(parseFloat(d)/parseFloat(i),""),v="<br/>("+number_format(c,2)+")";else var b="",v="";if(bt%mt==0){var f=vt/ft,_=parseFloat(vt)-parseFloat(f);f=f.toFixed(2),_=_.toFixed(2),vt=vt.toFixed(2),ct[ht]||(ct[ht]=""),ct[ht]=ct[ht]+"</table>",a&&""==a.tax_type&&(ct[ht]=ct[ht]+"<div style='"+T+U+"position:absolute; list-style-type: none; left:"+s.payments.left+"px;top:"+s.payments.top+"px;font-size:"+s.payments.fontSize+"px;'>"+f+"</div>",ct[ht]=ct[ht]+"<div style='"+q+Z+"position:absolute; list-style-type: none; left:"+s.payments2.left+"px;top:"+s.payments2.top+"px;font-size:"+s.payments2.fontSize+"px;'>"+_+"</div>"),ct[ht]=ct[ht]+"<div style='"+R+Q+"position:absolute; list-style-type: none; left:"+s.payments3.left+"px;top:"+s.payments3.top+"px;font-size:"+s.payments3.fontSize+"px;'>"+vt+"</div>",ht=parseInt(ht)+1,vt=0}vt=parseFloat(vt)+parseFloat(p),ct[ht]=ct[ht]+"<tr ><td style='"+O+at+"position:relative;width:"+s.tdbarcode.width+"px;padding-left:"+s.tdbarcode.left+"px;'>"+o+"</td><td style='"+C+ot+"position:relative;width:"+s.tdqty.width+"px;padding-left:"+s.tdqty.left+"px;'>"+i+"</td><td style='"+J+lt+"position:relative;width:"+s.tddescription.width+"px;padding-left:"+s.tddescription.left+"px;'> "+l+" <span style='padding-left:20px;'>"+b+"</span> </td><td style='"+D+nt+"position:relative;width:"+s.tdprice.width+"px;padding-left:"+s.tdprice.left+"px;'>"+number_format(r,2)+"</td><td style='"+E+it+"position:relative;width:"+s.tdtotal.width+"px;padding-left:"+s.tdtotal.left+"px;'>"+number_format(m,2)+" "+v+"</td></tr>",bt=parseInt(bt)+1}),vt>0){var yt=$("#hidconsumablepayment").val();yt>0&&(vt-=yt);var ut=vt/ft,gt=parseFloat(vt)-parseFloat(ut);ut=ut.toFixed(2),gt=gt.toFixed(2),vt=vt.toFixed(2),ct[ht]||(ct[ht]=""),ct[ht]=ct[ht]+"</table>",yt>0&&(ct[ht]=ct[ht]+"<div style='"+T+U+"position:absolute; list-style-type: none; left:"+s.payments.left+"px;top:"+(s.payments.top-12)+"px;font-size:"+s.payments.fontSize+"px;'>("+yt+")</div>"),a&&""==a.tax_type&&(ct[ht]=ct[ht]+"<div style='"+T+U+"position:absolute; list-style-type: none; left:"+s.payments.left+"px;top:"+s.payments.top+"px;font-size:"+s.payments.fontSize+"px;'>"+ut+"</div>",ct[ht]=ct[ht]+"<div style='"+q+Z+"position:absolute; list-style-type: none; left:"+s.payments2.left+"px;top:"+s.payments2.top+"px;font-size:"+s.payments2.fontSize+"px;'>"+gt+"</div>"),ct[ht]=ct[ht]+"<div style='"+R+Q+"position:absolute; list-style-type: none; left:"+s.payments3.left+"px;top:"+s.payments3.top+"px;font-size:"+s.payments3.fontSize+"px;'>"+vt+"</div>"}var $t="";_t||(_t="");var xt=$("#agent_id"),wt="";xt.val()&&(wt=xt.select2("data").text),_t=wt,_t=d+" "+_t;var St=$("#custom_dr").val(),Nt=parseInt(localStorage.dr)+1,kt=St?St:Nt,It=kt,Ft=localStorage.pref_dr?localStorage.pref_dr:"";It=t("000000",It,!0),It=Ft+It,m||(m=""),$t=$t+"<div style='"+G+K+"position:absolute;left:"+s.cashier.left+"px;top:"+s.cashier.top+"px;font-size:"+s.cashier.fontSize+"px;'>"+localStorage.current_lastname+", "+localStorage.current_firstname+"</div>",$t=$t+"<div style='"+W+X+"position:absolute;left:"+s.remarks.left+"px;top:"+s.remarks.top+"px;font-size:"+s.remarks.fontSize+"px;'>"+m+"</div>",$t=$t+"<div style='"+P+tt+"position:absolute;left:"+s.reserved.left+"px;top:"+s.reserved.top+"px;font-size:"+s.reserved.fontSize+"px;'>"+_t+"</div>",$t=$t+"<div style='"+j+et+"position:absolute;left:"+s.drnum.left+"px;top:"+s.drnum.top+"px;font-size:"+s.drnum.fontSize+"px;'>"+It+"</div>";var At="",zt=$("#sales_po_number").val(),Tt="";a&&a.terms&&(At=a.terms),a&&a.tin_no&&(Tt=a.tin_no);var qt=s.terms.visible?"display:inline-block;":"display:none;",Rt=s.ponum.visible?"display:inline-block;":"display:none;",Gt=s.tin.visible?"display:inline-block;":"display:none;",Wt=s.terms.bold?"font-weight:bold;":"font-weight:normal;",Pt=s.ponum.bold?"font-weight:bold;":"font-weight:normal;",jt=s.tin.bold?"font-weight:bold;":"font-weight:normal;";$t=$t+"<div style='"+qt+Wt+"position:absolute;left:"+s.terms.left+"px;top:"+s.terms.top+"px;font-size:"+s.terms.fontSize+"px;'>"+At+"</div>",$t=$t+"<div style='"+Rt+Pt+"position:absolute;left:"+s.ponum.left+"px;top:"+s.ponum.top+"px;font-size:"+s.ponum.fontSize+"px;'>"+zt+"</div>",$t=$t+"<div style='"+Gt+jt+"position:absolute;left:"+s.tin.left+"px;top:"+s.tin.top+"px;font-size:"+s.tin.fontSize+"px;'>"+Tt+"</div>",$t+="</div>";var Ot="";for(var f in ct)Ot=Ot+pt+ct[f]+$t;Ot=replaceAll(Ot,"undefined",""),st+="<div>"+Ot+"</div>"}M(st)}function J(e){if(0==localStorage.print_ir)return!0;var a="";try{a=JSON.parse($("#mem_data").val()),1==a.is_blacklisted?$(".notcashlist").hide():$(".notcashlist").show()}catch(o){}var l,n="font-family: Arial, Helvetica, sans-serif;",i=$("#member_id"),r="",s=JSON.parse(localStorage.ir_format);i.val()&&(r=$("#member_id").select2("data").text,l=r.split(","),r=l[0]);var d="";localStorage.members&&(d=JSON.parse(localStorage.members));var p=$("#sales_remarks").val(),m="",c="",h=$("#opt_station"),b="";if(d)for(var v in d){var f=d[v];f.id==i.val()&&(m=f.personal_address+"<br>Contact Person: "+f.firstname+" "+f.lastname+"<br>Contact #: "+f.contact_number)}i.val()&&(m=$("#member_id").select2("data").address),h.val()&&(c=$("#"+h.attr("id")+" :selected").attr("data-address"),b=$("#"+h.attr("id")+" :selected").text());var _=Date.now()/1e3,y=parseInt(localStorage.servertime)-parseInt(localStorage.localtime);_=parseInt(_)+parseInt(y);var u=new Date(1e3*_),g=u.getMonth()+1,x=u.getDate(),w=(10>g?"0":"")+g+"/"+(10>x?"0":"")+x+"/"+u.getFullYear(),S=$("#custom_date_sold").val();S&&(w=S);var N=s.date.visible?"display:block;":"display:none;",k=s.membername.visible?"display:block;":"display:none;",I=s.memberaddress.visible?"display:block;":"display:none;",F=s.stationname.visible?"display:block;":"display:none;",A=s.stationaddress.visible?"display:block;":"display:none;",z=(s.itemtable.visible?"display:block;":"display:none;",s.payments.visible?"display:block;":"display:none;"),T=s.payments2.visible?"display:block;":"display:none;",q=s.payments3.visible?"display:block;":"display:none;",R=s.cashier.visible?"display:block;":"display:none;",G=s.remarks.visible?"display:block;":"display:none;",W=s.reserved.visible?"display:block;":"display:none;",P=s.drnum.visible?"display:block;":"display:none;",j=s.tdbarcode.visible?"display:inline-block;":"display:none;",O=s.tdqty.visible?"display:inline-block;":"display:none;",C=s.tddescription.visible?"display:inline-block;":"display:none;",J=s.tdprice.visible?"display:inline-block;":"display:none;",D=s.tdtotal.visible?"display:inline-block;":"display:none;",E=s.date.bold?"font-weight:bold;":"font-weight:normal;",L=s.membername.bold?"font-weight:bold;":"font-weight:normal;",Y=s.memberaddress.bold?"font-weight:bold;":"font-weight:normal;",B=s.stationname.bold?"font-weight:bold;":"font-weight:normal;",V=s.stationaddress.bold?"font-weight:bold;":"font-weight:normal;",H=(s.itemtable.bold?"font-weight:bold;":"font-weight:normal;",s.payments.bold?"font-weight:bold;":"font-weight:normal;"),U=s.payments2.bold?"font-weight:bold;":"font-weight:normal;",Z=s.payments3.bold?"font-weight:bold;":"font-weight:normal;",Q=s.cashier.bold?"font-weight:bold;":"font-weight:normal;",K=s.remarks.bold?"font-weight:bold;":"font-weight:normal;",X=s.reserved.bold?"font-weight:bold;":"font-weight:normal;",tt=s.drnum.bold?"font-weight:bold;":"font-weight:normal;",et=s.tdbarcode.bold?"font-weight:bold;":"font-weight:normal;",at=s.tdqty.bold?"font-weight:bold;":"font-weight:normal;",ot=s.tddescription.bold?"font-weight:bold;":"font-weight:normal;",lt=s.tdprice.bold?"font-weight:bold;":"font-weight:normal;",nt=s.tdtotal.bold?"font-weight:bold;":"font-weight:normal;",it=$("#print_copy").val();it=it?parseInt(it):1;for(var rt="",st=1;it>=st;st++){1==st?(J="display:none;",D="display:none;"):(J=s.tdprice.visible?"display:inline-block;":"display:none;",D=s.tdtotal.visible?"display:inline-block;":"display:none;");var dt="";dt=dt+"<div id='maindivforprinting' style='page-break-before: always;position:relative;"+n+"'>&nbsp;",dt=dt+"<div style='"+N+E+"position:absolute;top:"+s.date.top+"px; left:"+s.date.left+"px;font-size:"+s.date.fontSize+"px;'><br/><br/>"+w+" </div><div style='clear:both;'></div>",dt=dt+"<div style='"+k+L+"position:absolute;top:"+s.membername.top+"px; left:"+s.membername.left+"px;font-size:"+s.membername.fontSize+"px;'>"+r+"</div>",dt=dt+"<div style='"+I+Y+"position:absolute;top:"+s.memberaddress.top+"px; left:"+s.memberaddress.left+"px;width:"+s.memberaddress.width+"px;font-size:"+s.memberaddress.fontSize+"px;'>"+m+"</div>",dt=dt+"<div style='"+F+B+"position:absolute;top:"+s.stationname.top+"px; left:"+s.stationname.left+"px;font-size:"+s.stationname.fontSize+"px;'>"+b+"</div>",dt=dt+"<div style='"+A+V+"position:absolute;top:"+s.stationaddress.top+"px; left:"+s.stationaddress.left+"px;width:"+s.stationaddress.width+"px;font-size:"+s.stationaddress.fontSize+"px;'>"+c+"</div>",dt=dt+"<table id='itemscon' style='position:absolute;top:"+s.itemtable.top+"px;left:"+s.itemtable.left+"px;font-size:"+s.itemtable.fontSize+"px;'> ";var pt=($("#cart > tbody > tr").length,localStorage.ir_limit),mt=[],ct=1,ht=1,bt=0,vt=1.12;pt=parseInt(pt)+1;var ft="";if($("#cart > tbody > tr").each(function(t){var e=$(this),o=e.attr("data-itemcode"),l=e.attr("data-desc"),n=(e.attr("data-barcode"),e.attr("data-unit_name"));n=n?n:"";var i=e.children().eq(1).text()+"<span style='margin-left:50px;'>"+n+"</span>",r=e.children().eq(2).text(),d=e.children().eq(3).find("input").val(),p=replaceAll(e.children().eq(4).text(),",",""),m=parseFloat(i)*parseFloat(r),c=e.children().eq(3).text(),h=parseFloat(e.attr("data-store_discount"));if(d=parseFloat(d)+h,ft=e.attr("data-reserved_by"),0!=parseFloat(c))var b=(parseFloat(d)/parseFloat(i),""),v="<br/>("+number_format(c,2)+")";else var b="",v="";if(ht%pt==0){var f=bt/vt,_=parseFloat(bt)-parseFloat(f);f=f.toFixed(2),_=_.toFixed(2),bt=bt.toFixed(2),mt[ct]||(mt[ct]=""),mt[ct]=mt[ct]+"</table>",a&&""==a.tax_type&&(mt[ct]=mt[ct]+"<div style='"+z+H+"position:absolute; list-style-type: none; left:"+s.payments.left+"px;top:"+s.payments.top+"px;font-size:"+s.payments.fontSize+"px;'>"+f+"</div>",mt[ct]=mt[ct]+"<div style='"+T+U+"position:absolute; list-style-type: none; left:"+s.payments2.left+"px;top:"+s.payments2.top+"px;font-size:"+s.payments2.fontSize+"px;'>"+_+"</div>"),mt[ct]=mt[ct]+"<div style='"+q+Z+"position:absolute; list-style-type: none; left:"+s.payments3.left+"px;top:"+s.payments3.top+"px;font-size:"+s.payments3.fontSize+"px;'>"+bt+"</div>",ct=parseInt(ct)+1,bt=0}bt=parseFloat(bt)+parseFloat(p),mt[ct]=mt[ct]+"<tr ><td style='"+j+et+"position:relative;width:"+s.tdbarcode.width+"px;padding-left:"+s.tdbarcode.left+"px;'>"+o+"</td><td style='"+O+at+"position:relative;width:"+s.tdqty.width+"px;padding-left:"+s.tdqty.left+"px;'>"+i+"</td><td style='"+C+ot+"position:relative;width:"+s.tddescription.width+"px;padding-left:"+s.tddescription.left+"px;'> "+l+" <span style='padding-left:20px;'>"+b+"</span> </td><td style='"+J+lt+"position:relative;width:"+s.tdprice.width+"px;padding-left:"+s.tdprice.left+"px;'>"+number_format(r,2)+"</td><td style='"+D+nt+"position:relative;width:"+s.tdtotal.width+"px;padding-left:"+s.tdtotal.left+"px;'>"+number_format(m,2)+" "+v+"</td></tr>",ht=parseInt(ht)+1}),bt>0){var _t=$("#hidconsumablepayment").val();_t>0&&(bt-=_t);var yt=bt/vt,ut=parseFloat(bt)-parseFloat(yt);yt=yt.toFixed(2),ut=ut.toFixed(2),bt=bt.toFixed(2),mt[ct]||(mt[ct]=""),mt[ct]=mt[ct]+"</table>",_t>0&&(mt[ct]=mt[ct]+"<div style='"+z+H+"position:absolute; list-style-type: none; left:"+s.payments.left+"px;top:"+(s.payments.top-12)+"px;font-size:"+s.payments.fontSize+"px;'>("+_t+")</div>"),a&&""==a.tax_type&&(mt[ct]=mt[ct]+"<div style='"+z+H+"position:absolute; list-style-type: none; left:"+s.payments.left+"px;top:"+s.payments.top+"px;font-size:"+s.payments.fontSize+"px;'>"+yt+"</div>",mt[ct]=mt[ct]+"<div style='"+T+U+"position:absolute; list-style-type: none; left:"+s.payments2.left+"px;top:"+s.payments2.top+"px;font-size:"+s.payments2.fontSize+"px;'>"+ut+"</div>"),mt[ct]=mt[ct]+"<div style='"+q+Z+"position:absolute; list-style-type: none; left:"+s.payments3.left+"px;top:"+s.payments3.top+"px;font-size:"+s.payments3.fontSize+"px;'>"+bt+"</div>"}var gt="";ft||(ft="");var $t=$("#agent_id"),xt="";$t.val()&&(xt=$t.select2("data").text),ft=xt;var wt=$("#custom_ir").val(),St=parseInt(localStorage.ir)+1,Nt=wt?wt:St,kt=Nt,It=localStorage.pref_ir?localStorage.pref_ir:"";kt=t("000000",kt,!0),kt=It+kt,p||(p=""),gt=gt+"<div style='"+R+Q+"position:absolute;left:"+s.cashier.left+"px;top:"+s.cashier.top+"px;font-size:"+s.cashier.fontSize+"px;'>"+localStorage.current_lastname+", "+localStorage.current_firstname+"</div>",gt=gt+"<div style='"+G+K+"position:absolute;left:"+s.remarks.left+"px;top:"+s.remarks.top+"px;font-size:"+s.remarks.fontSize+"px;'>"+p+"</div>",gt=gt+"<div style='"+W+X+"position:absolute;left:"+s.reserved.left+"px;top:"+s.reserved.top+"px;font-size:"+s.reserved.fontSize+"px;'>"+ft+"</div>",gt=gt+"<div style='"+P+tt+"position:absolute;left:"+s.drnum.left+"px;top:"+s.drnum.top+"px;font-size:"+s.drnum.fontSize+"px;'>"+kt+"</div>";var Ft="",At="",zt="",Tt=s.terms.visible?"display:inline-block;":"display:none;",qt=s.ponum.visible?"display:inline-block;":"display:none;",Rt=s.tin.visible?"display:inline-block;":"display:none;",Gt=s.terms.bold?"font-weight:bold;":"font-weight:normal;",Wt=s.ponum.bold?"font-weight:bold;":"font-weight:normal;",Pt=s.tin.bold?"font-weight:bold;":"font-weight:normal;";gt=gt+"<div style='"+Tt+Gt+"position:absolute;left:"+s.terms.left+"px;top:"+s.terms.top+"px;font-size:"+s.terms.fontSize+"px;'>"+Ft+"</div>",gt=gt+"<div style='"+qt+Wt+"position:absolute;left:"+s.ponum.left+"px;top:"+s.ponum.top+"px;font-size:"+s.ponum.fontSize+"px;'>"+At+"</div>",gt=gt+"<div style='"+Rt+Pt+"position:absolute;left:"+s.tin.left+"px;top:"+s.tin.top+"px;font-size:"+s.tin.fontSize+"px;'>"+zt+"</div>",gt+="</div>";var jt="";for(var v in mt)jt=jt+dt+mt[v]+gt;jt=replaceAll(jt,"undefined",""),rt+="<div>"+jt+"</div>"}M(rt)}function D(t){var e="";try{e=JSON.parse($("#mem_data").val()),1==e.is_blacklisted?$(".notcashlist").hide():$(".notcashlist").show()}catch(a){}var o,l="font-family: Arial, Helvetica, sans-serif;",n=1,i=$("#member_id"),r="",s=JSON.parse(localStorage.news_format);i.val()&&(r=$("#member_id").select2("data").text,o=r.split(","),r=o[0]);var d="";localStorage.members&&(d=JSON.parse(localStorage.members));var p=$("#sales_remarks").val(),m="",c="",h=$("#opt_station"),b="";if(d)for(var v in d){var f=d[v];f.id==i.val()&&(m=f.personal_address+"<br>Contact Person: "+f.firstname+" "+f.lastname+"<br>Contact #: "+f.contact_number)}i.val()&&(m=$("#member_id").select2("data").address),h.val()&&(c=$("#"+h.attr("id")+" :selected").attr("data-address"),b=$("#"+h.attr("id")+" :selected").text());var _=Date.now()/1e3,y=parseInt(localStorage.servertime)-parseInt(localStorage.localtime);_=parseInt(_)+parseInt(y);var u=new Date(1e3*_),g=u.getMonth()+1,x=u.getDate(),w=(10>g?"0":"")+g+"/"+(10>x?"0":"")+x+"/"+u.getFullYear(),S=$("#custom_date_sold").val();S&&(w=S);var N=s.date.visible?"display:block;":"display:none;",k=s.membername.visible?"display:block;":"display:none;",I=s.memberaddress.visible?"display:block;":"display:none;",F=s.stationname.visible?"display:block;":"display:none;",A=s.stationaddress.visible?"display:block;":"display:none;",z=(s.itemtable.visible?"display:block;":"display:none;",s.payments.visible?"display:block;":"display:none;"),T=s.payments2.visible?"display:block;":"display:none;",q=s.payments3.visible?"display:block;":"display:none;",R=s.cashier.visible?"display:block;":"display:none;",G=s.remarks.visible?"display:block;":"display:none;",W=s.reserved.visible?"display:block;":"display:none;",P=s.drnum.visible?"display:block;":"display:none;",j=s.tdbarcode.visible?"display:inline-block;":"display:none;",O=s.tdqty.visible?"display:inline-block;":"display:none;",C=s.tddescription.visible?"display:inline-block;":"display:none;",J=s.tdprice.visible?"display:inline-block;":"display:none;",D=s.tdtotal.visible?"display:inline-block;":"display:none;",E=s.date.bold?"font-weight:bold;":"font-weight:normal;",L=s.membername.bold?"font-weight:bold;":"font-weight:normal;",Y=s.memberaddress.bold?"font-weight:bold;":"font-weight:normal;",B=s.stationname.bold?"font-weight:bold;":"font-weight:normal;",V=s.stationaddress.bold?"font-weight:bold;":"font-weight:normal;",H=(s.itemtable.bold?"font-weight:bold;":"font-weight:normal;",s.payments.bold?"font-weight:bold;":"font-weight:normal;"),U=s.payments2.bold?"font-weight:bold;":"font-weight:normal;",Z=s.payments3.bold?"font-weight:bold;":"font-weight:normal;",Q=s.cashier.bold?"font-weight:bold;":"font-weight:normal;",K=s.remarks.bold?"font-weight:bold;":"font-weight:normal;",X=s.reserved.bold?"font-weight:bold;":"font-weight:normal;",tt=s.drnum.bold?"font-weight:bold;":"font-weight:normal;",et=s.tdbarcode.bold?"font-weight:bold;":"font-weight:normal;",at=s.tdqty.bold?"font-weight:bold;":"font-weight:normal;",ot=s.tddescription.bold?"font-weight:bold;":"font-weight:normal;",lt=s.tdprice.bold?"font-weight:bold;":"font-weight:normal;",nt=s.tdtotal.bold?"font-weight:bold;":"font-weight:normal;",it=$("#print_copy").val();it=it?parseInt(it):1;for(var rt="",st=1;it>=st;st++){var dt="";dt=dt+"<div id='maindivforprinting' style='page-break-before: always;position:relative;"+l+"'>&nbsp;",dt=dt+"<div style='"+N+E+"position:absolute;top:"+s.date.top+"px; left:"+s.date.left+"px;font-size:"+s.date.fontSize+"px;'><br/><br/>"+w+" </div><div style='clear:both;'></div>",dt=dt+"<div style='"+k+L+"position:absolute;top:"+s.membername.top+"px; left:"+s.membername.left+"px;font-size:"+s.membername.fontSize+"px;'>"+r+"</div>",dt=dt+"<div style='"+I+Y+"position:absolute;top:"+s.memberaddress.top+"px; left:"+s.memberaddress.left+"px;width:"+s.memberaddress.width+"px;font-size:"+s.memberaddress.fontSize+"px;'>"+m+"</div>",dt=dt+"<div style='"+F+B+"position:absolute;top:"+s.stationname.top+"px; left:"+s.stationname.left+"px;font-size:"+s.stationname.fontSize+"px;'>"+b+"</div>",dt=dt+"<div style='"+A+V+"position:absolute;top:"+s.stationaddress.top+"px; left:"+s.stationaddress.left+"px;width:"+s.stationaddress.width+"px;font-size:"+s.stationaddress.fontSize+"px;'>"+c+"</div>",dt=dt+"<table id='itemscon' style='position:absolute;top:"+s.itemtable.top+"px;left:"+s.itemtable.left+"px;font-size:"+s.itemtable.fontSize+"px;'> ";var pt=($("#cart > tbody > tr").length,localStorage.dr_limit),mt=[],ct=1,ht=1,bt=0,vt=1.12;pt=parseInt(pt)+1;var ft="";if($("#cart > tbody > tr").each(function(t){var a=$(this),o=a.attr("data-itemcode"),l=a.attr("data-desc"),i=(a.attr("data-barcode"),a.attr("data-unit_name"));i=i?i:"";var r=a.children().eq(1).text()+"<span style='margin-left:50px;'>"+i+"</span>",d=a.children().eq(2).text(),p=0,m=replaceAll(a.children().eq(4).text(),",",""),c=parseFloat(r)*parseFloat(d),h=a.children().eq(3).text(),b=parseFloat(a.attr("data-member_adjustment"));p=parseFloat(p)+b,ft=a.attr("data-reserved_by");var v="",f="";if(0!=parseFloat(h)){var _=parseFloat(p)/parseFloat(a.children().eq(1).text());1==n?(d=parseFloat(d)+parseFloat(_),c=m):(v="",f="<br/>("+number_format(h,2)+")")}if(ht%pt==0){var y=bt/vt,u=parseFloat(bt)-parseFloat(y);y=y.toFixed(2),u=u.toFixed(2),bt=bt.toFixed(2),mt[ct]||(mt[ct]=""),mt[ct]=mt[ct]+"</table>",e&&""==e.tax_type&&(mt[ct]=mt[ct]+"<div style='"+z+H+"position:absolute; list-style-type: none; left:"+s.payments.left+"px;top:"+s.payments.top+"px;font-size:"+s.payments.fontSize+"px;'>"+y+"</div>",mt[ct]=mt[ct]+"<div style='"+T+U+"position:absolute; list-style-type: none; left:"+s.payments2.left+"px;top:"+s.payments2.top+"px;font-size:"+s.payments2.fontSize+"px;'>"+u+"</div>"),mt[ct]=mt[ct]+"<div style='"+q+Z+"position:absolute; list-style-type: none; left:"+s.payments3.left+"px;top:"+s.payments3.top+"px;font-size:"+s.payments3.fontSize+"px;'>"+bt+"</div>",ct=parseInt(ct)+1,bt=0}bt=parseFloat(bt)+parseFloat(m),mt[ct]=mt[ct]+"<tr ><td style='"+j+et+"position:relative;width:"+s.tdbarcode.width+"px;padding-left:"+s.tdbarcode.left+"px;'>"+o+"</td><td style='"+O+at+"position:relative;width:"+s.tdqty.width+"px;padding-left:"+s.tdqty.left+"px;'>"+r+"</td><td style='"+C+ot+"position:relative;width:"+s.tddescription.width+"px;padding-left:"+s.tddescription.left+"px;'> "+l+" <span style='padding-left:20px;'>"+v+"</span> </td><td style='"+J+lt+"position:relative;width:"+s.tdprice.width+"px;padding-left:"+s.tdprice.left+"px;'>"+number_format(d,2)+"</td><td style='"+D+nt+"position:relative;width:"+s.tdtotal.width+"px;padding-left:"+s.tdtotal.left+"px;'>"+number_format(c,2)+" "+f+"</td></tr>",ht=parseInt(ht)+1}),bt>0){var _t=bt/vt,yt=parseFloat(bt)-parseFloat(_t);_t=_t.toFixed(2),yt=yt.toFixed(2),bt=bt.toFixed(2),mt[ct]||(mt[ct]=""),mt[ct]=mt[ct]+"</table>",e&&""==e.tax_type&&(mt[ct]=mt[ct]+"<div style='"+z+H+"position:absolute; list-style-type: none; left:"+s.payments.left+"px;top:"+s.payments.top+"px;font-size:"+s.payments.fontSize+"px;'>"+_t+"</div>",mt[ct]=mt[ct]+"<div style='"+T+U+"position:absolute; list-style-type: none; left:"+s.payments2.left+"px;top:"+s.payments2.top+"px;font-size:"+s.payments2.fontSize+"px;'>"+yt+"</div>"),mt[ct]=mt[ct]+"<div style='"+q+Z+"position:absolute; list-style-type: none; left:"+s.payments3.left+"px;top:"+s.payments3.top+"px;font-size:"+s.payments3.fontSize+"px;'>"+bt+"</div>"}var ut="";ft||(ft="");var gt=$("#agent_id"),$t="";gt.val()&&($t=gt.select2("data").text),ft=$t;var xt="",wt="",St=xt?xt:wt,Nt=St;p||(p=""),ut=ut+"<div style='"+R+Q+"position:absolute;left:"+s.cashier.left+"px;top:"+s.cashier.top+"px;font-size:"+s.cashier.fontSize+"px;'>"+localStorage.current_lastname+", "+localStorage.current_firstname+"</div>",ut=ut+"<div style='"+G+K+"position:absolute;left:"+s.remarks.left+"px;top:"+s.remarks.top+"px;font-size:"+s.remarks.fontSize+"px;'>"+p+"</div>",ut=ut+"<div style='"+W+X+"position:absolute;left:"+s.reserved.left+"px;top:"+s.reserved.top+"px;font-size:"+s.reserved.fontSize+"px;'>"+ft+"</div>",ut=ut+"<div style='"+P+tt+"position:absolute;left:"+s.drnum.left+"px;top:"+s.drnum.top+"px;font-size:"+s.drnum.fontSize+"px;'>"+Nt+"</div>";var kt="",It="",Ft="",At=s.terms.visible?"display:inline-block;":"display:none;",zt=s.ponum.visible?"display:inline-block;":"display:none;",Tt=s.tin.visible?"display:inline-block;":"display:none;",qt=s.terms.bold?"font-weight:bold;":"font-weight:normal;",Rt=s.ponum.bold?"font-weight:bold;":"font-weight:normal;",Gt=s.tin.bold?"font-weight:bold;":"font-weight:normal;";ut=ut+"<div style='"+At+qt+"position:absolute;left:"+s.terms.left+"px;top:"+s.terms.top+"px;font-size:"+s.terms.fontSize+"px;'>"+kt+"</div>",ut=ut+"<div style='"+zt+Rt+"position:absolute;left:"+s.ponum.left+"px;top:"+s.ponum.top+"px;font-size:"+s.ponum.fontSize+"px;'>"+It+"</div>",ut=ut+"<div style='"+Tt+Gt+"position:absolute;left:"+s.tin.left+"px;top:"+s.tin.top+"px;font-size:"+s.tin.fontSize+"px;'>"+Ft+"</div>",ut+="</div>";var Wt="";for(var v in mt)Wt=Wt+dt+mt[v]+ut;Wt=replaceAll(Wt,"undefined",""),rt+="<div>"+Wt+"</div>"}M(rt)}function M(t){var e=window.open("","new div","");return e.document.write("<html><head><title></title><style></style>"),e.document.write('</head><body style="padding:0;margin:0;">'),e.document.write(t),e.document.write("</body></html>"),e.print(),e.close(),!0}function E(){var t=$("#member_id").val(),e=localStorage.terminal_id;$.ajax({url:"../ajax/ajax_query2.php",type:"POST",beforeSend:function(){$("#lastSold").html("Fetching record. Please wait...")},data:{functionName:"lastSoldItem",member_id:t,terminal_id:e},success:function(t){if($("#lastSold").html(t),$("#service_used_items").length)try{o();var e=JSON.parse($("#service_used_items").val());for(var a in e)$("#cart tbody").append("<tr data-barcode='"+e[a].barcode+"' data-itemcode='"+e[a].item_code+"' data-desc='"+e[a].description+"' data-item_id='"+e[a].item_id+"' data-price_adjustment='0' data-member_adjustment='0'><td>"+e[a].item_code+"</td><td>"+e[a].qty+"</td><td>"+e[a].price+"</td><td>0</td><td>"+e[a].total+"</td><td><span  class='glyphicon glyphicon-remove-sign removeItem'></span></td></tr>");l()}catch(n){}if($("#mem_salestype").val()&&($("#sales_type").val($("#mem_salestype").val()),$("#sales_type").attr("disabled",!0)),$("#mem_point_reg").length)try{var i=JSON.parse($("#mem_point_reg").val()),r="";for(var s in i)r+=" <input checked type='checkbox' class='member_point_enrolled'  value='"+i[s].point_id+"'> "+i[s].point_name;$("#point_holder").html(r)}catch(n){}},error:function(){alert("Error Occur")}})}function L(){var t=[];return $("#mem_point_reg").length&&$(".member_point_enrolled:checkbox:checked").each(function(){t.push($(this).val())}),JSON.stringify(t)}function Y(){$("#all_content").hide(),$("#error_content").hide(),"0"!=localStorage.terminal_id?$("#all_content").fadeIn(300):$("#error_content").fadeIn(300)}function B(){var t=$("#cart tbody tr").length;parseFloat(t)>0?($("#member_id").select2("disable",!0),$("#checkout").attr("disabled",!1),$("#print").attr("disabled",!1)):($("#member_id").select2("enable",!0),$("#checkout").attr("disabled",!0),$("#print").attr("disabled",!0))}function V(){Date.now||(Date.now=function(){return(new Date).getTime()});var t=Date.now()/1e3;$.ajax({url:"../ajax/ajax_getservertime.php",type:"POST",data:{},success:function(e){localStorage.servertime=e,localStorage.localtime=Math.floor(t)}})}function H(){var t=indexedDB.open(ct,ht);t.onupgradeneeded=function(t){var e=t.target.result,a=null;e.objectStoreNames.contains("members")||(a=e.createObjectStore("members",{keyPath:"id"}),a.createIndex("lastname","lastname",{unique:!1}));var o=null;e.objectStoreNames.contains("items")||(o=e.createObjectStore("items",{keyPath:"barcode"}),o.createIndex("barcode","items",{unique:!0}))},t.onsuccess=function(t){mt=t.target.result},t.onerror=function(t){}}function U(t){var e=mt.transaction(["items"],"readwrite"),a=e.objectStore("items"),o=a.add(t);o.onsuccess=function(t){},o.onerror=function(t){}}function Z(t){var e=mt.transaction(["items"],"readonly"),a=e.objectStore("items"),o=a.get(t);o.onsuccess=function(t){Q(t.target.result)},o.onerror=function(){showToast("error","<p>Invalid barcode</p>","<h3>WARNING!</h3>","toast-bottom-right")}}function Q(t){if(t){var e=t.barcode,a=t.item_code,n=t.description,i=t.price,r=t.is_bundle,s=1,d=parseFloat(i)*s;$("#cart tbody").append("<tr data-is_bundle='"+r+"' data-unit_name='"+t.unit_name+"' data-barcode='"+e+"' data-itemcode='"+a+"' data-desc='"+n+"' data-item_id='"+t.item_id+"' data-price_adjustment='0' data-member_adjustment='0'><td>"+a+"</td><td>"+s+"</td><td>"+i+"</td><td>0</td><td>"+d+"</td><td><span  class='glyphicon glyphicon-remove-sign removeItem'></span></td></tr>"),o(),l()}else showToast("error","<p>Invalid barcode</p>","<h3>WARNING!</h3>","toast-bottom-right")}function K(){var t=300;document.onkeypress=function(e){e=e||window.event;var a="number"==typeof e.which?e.which:e.keyCode;localStorage.getItem("scan")&&"null"!=localStorage.getItem("scan")?localStorage.setItem("scan",localStorage.getItem("scan")+String.fromCharCode(a)):(localStorage.setItem("scan",String.fromCharCode(a)),setTimeout(function(){localStorage.removeItem("scan")},t)),localStorage.getItem("scan").length>=8&&Z(localStorage.getItem("scan"))}}function X(){var t=$("#op_cashreceivetext").val();t||(t=0);var e=$("#op_hidcreditpayment").val();e||(e=0);var a=$("#op_hidbanktransferpayment").val();a||(a=0);var o=$("#op_hidchequepayment").val();o||(o=0);var l=parseFloat(t)+parseFloat(e)+parseFloat(a)+parseFloat(o);$("#op_totalOfAllPayment").html("<strong><span style='font-size:1.2em;' class='text-info' >Total Over Payment: "+l.toFixed(2)+"</span></strong>")}function tt(){var t=$("#op_cashreceivetext").val();t||(t=0),$("#op_totalcashpayment").html(t),X()}function et(){var t=0;$("#op_credit_table tr").children().length&&$("#op_credit_table tr").each(function(e){var a=$(this),o=a.children().eq(1).text();t=parseFloat(t)+parseFloat(o)}),$("#op_totalcreditpayment").html(t),$("#op_hidcreditpayment").val(t),X()}function at(){var t=0;$("#op_bt_table tr").children().length&&$("#op_bt_table tr").each(function(e){var a=$(this),o=a.children().eq(1).text();t=parseFloat(t)+parseFloat(o)}),$("#op_totalbanktransferpayment").html(t),$("#op_hidbanktransferpayment").val(t),X()}function ot(){var t=0;$("#op_ch_table tr").children().length&&$("#op_ch_table tr").each(function(e){var a=$(this),o=a.children().eq(2).text();t=parseFloat(t)+parseFloat(o)}),$("#op_totalchequepayment").html(t),$("#op_hidchequepayment").val(t),X()}function lt(){if($("#op_ch_table tr").children().length){var t=new Array,e=$("#op_ch_firstname").val(),a=$("#op_ch_middlename").val(),o=$("#op_ch_lastname").val(),l=$("#op_ch_phone").val();return e&&!F(e)?(showToast("error","<p>First name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):a&&!F(a)?(showToast("error","<p>Middle name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):o&&!F(o)?(showToast("error","<p>Last name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):l&&!F(l)?(showToast("error","<p>Phone should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):($("#op_ch_table tr").each(function(n){var i=$(this);t[n]={date:i.children().eq(0).text(),cheque_number:i.children().eq(1).text(),amount:i.children().eq(2).text(),bank_name:i.children().eq(3).text(),firstname:e,lastname:o,middlename:a,phone:l}}),localStorage.op_payment_cheque=JSON.stringify(t),!0)}return!0}function nt(){if($("#op_credit_table tr").children().length){var t=new Array,e=$("#op_billing_firstname").val(),a=$("#op_billing_middlename").val(),o=$("#op_billing_lastname").val(),l=$("#op_billing_company").val(),n=$("#op_billing_address").val(),i=$("#op_billing_postal").val(),r=$("#op_billing_phone").val(),s=$("#op_billing_email").val(),d=$("#op_billing_remarks").val(),p=$("#op_billing_card_type").val(),m=$("#op_billing_trace_number").val(),c=$("#op_billing_approval_code").val(),h=$("#op_billing_date").val();return p&&m&&c&&h?o&&!F(o)?(showToast("error","<p>Last name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),
	!1):e&&!F(e)?(showToast("error","<p>First name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):a&&!F(a)?(showToast("error","<p>Middle name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):l&&!F(l)?(showToast("error","<p>Company should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):n&&!F(n)?(showToast("error","<p>Address should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):i&&!z(i)?(showToast("error","<p>Postal should be numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):r&&!F(r)?(showToast("error","<p>Phone should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):s&&!T(s)?(showToast("error","<p>Email should be valid email address</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):d&&!F(d)?(showToast("error","<p>Remarks should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):($("#op_credit_table tr").each(function(b){var v=$(this);t[b]={credit_number:v.children().eq(0).text(),amount:v.children().eq(1).text(),bank_name:v.children().eq(2).text(),firstname:e,lastname:o,middlename:a,phone:r,comp:l,add:n,postal:i,email:s,remarks:d,card_type:p,trace_number:m,approval_code:c,date:h}}),localStorage.op_payment_credit=JSON.stringify(t),!0):(showToast("error","<p>Please Complete Credit Card billing form. </p>","<h3>WARNING!</h3>","toast-bottom-right"),!1)}return!0}function it(){if($("#op_bt_table tr").children().length){var t=new Array,e=$("#op_bt_bankto_name").val(),a=$("#op_bt_bankto_account_number").val(),o=$("#op_bt_firstname").val(),l=$("#op_bt_middlename").val(),n=$("#op_bt_lastname").val(),i=$("#op_bt_company").val(),r=$("#op_bt_address").val(),s=$("#op_bt_postal").val(),d=$("#op_bt_phone").val(),p=$("#op_bt_date").val();return p?e&&!F(e)?(showToast("error","<p>Bank name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):a&&!F(a)?(showToast("error","<p>Bank account number should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):o&&!F(o)?(showToast("error","<p>First name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):l&!F(l)?(showToast("error","<p>Middle name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):n&&!F(n)?(showToast("error","<p>Last name should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):i&&!F(i)?(showToast("error","<p>Company should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):r&&!F(r)?(showToast("error","<p>Address should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):s&&!z(s)?(showToast("error","<p>Phone should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):d&&!F(d)?(showToast("error","<p>Phone should have letters and numbers only</p>","<h3>WARNING!</h3>","toast-bottom-right"),!1):($("#op_bt_table tr").each(function(m){var c=$(this);t[m]={credit_number:c.children().eq(0).text(),amount:c.children().eq(1).text(),bank_name:c.children().eq(2).text(),bt_bankto_name:e,bt_bankto_account_number:a,firstname:o,lastname:n,middlename:l,phone:d,comp:i,add:r,postal:s,date:p}}),localStorage.op_payment_bt=JSON.stringify(t),!0):(showToast("error","<p>Please Bank Transfer  billing form. </p>","<h3>WARNING!</h3>","toast-bottom-right"),!1)}return!0}function rt(){var t=$("#op_hidcashpayment").val();t||(t=0);var e=$("#op_hidcreditpayment").val();e||(e=0);var a=$("#op_hidbanktransferpayment").val();a||(a=0);var o=$("#op_hidchequepayment").val();o||(o=0);var l=parseFloat(t)+parseFloat(e)+parseFloat(a)+parseFloat(o);if(l){if(!lt()||!nt()||!it())return;var n=0;t=parseFloat(t)-parseFloat(n),localStorage.op_payment_cash=t;var i,r,s,d;localStorage.op_payment_cash&&(d=localStorage.op_payment_cash),localStorage.op_payment_credit&&(i=localStorage.op_payment_credit),localStorage.op_payment_bt&&(r=localStorage.op_payment_bt),localStorage.op_payment_cheque&&(s=localStorage.op_payment_cheque),$("#op_credit_table").find("tr").remove(),$("#op_bt_table").find("tr").remove(),$("#op_ch_table").find("tr").remove(),$("#over_payment_b :input[type='text']").val(""),$("#over_payment_c :input[type='text']").val(""),$("#over_payment_d :input[type='text']").val(""),$("#over_payment_a :input[type='text']").val(""),$("#op_label_holder").show(),$("#op_grandtotalholder").html(number_format(l,2)),$("#modalOverPayment").modal("hide")}}localStorage.removeItem("op_payment_cheque"),localStorage.removeItem("op_payment_credit"),localStorage.removeItem("op_payment_bt"),localStorage.removeItem("op_payment_cash");var st="<?php echo INVOICE_LABEL; ?>",dt="<?php echo DR_LABEL; ?>",pt="<?php echo PR_LABEL; ?>";a(),$("body").on("click",".removeItem",function(){$(this).parents("tr").remove(),a(),l()}),$("#void").click(function(){$("#cart").find("tr:gt(0)").remove(),a(),l()}),$("body").on("change","#item_id",function(){var t=$("#item_id"),e=t.val(),a=t.select2("data").text.split(":"),n=a[3],i=a[0],r=a[2],s=a[1],d=t.select2("data").is_bundle,p=$("#qty").val(),m=$("#member_id").val();if(e&&p){if(isNaN(p)||parseFloat(p)<0)return alertify.alert("Invalid Quantity"),t.select2("val",null),void $("#qty").val("");$(".loading").show(),$.ajax({url:"../ajax/ajax_query2.php",type:"POST",data:{functionName:"getAdjustmentPrice",branch_id:localStorage.branch_id,item_id:e,member_id:m,qty:p},success:function(m){var c=m.split(":");n=parseFloat(n)+parseFloat(c[0]);var h=c[1];a=a[2]+"<small style='display:block' class='text-danger'>"+a[1]+"</small>";var b=parseFloat(n)*parseFloat(p);b=parseFloat(b)+parseFloat(h),b=number_format(b,2),$("<tr data-is_bundle='"+d+"' data-unit_name='"+t.select2("data").unit_name+"' data-barcode='"+i+"' data-itemcode='"+s+"' data-desc='"+r+"' data-item_id='"+e+"' data-price_adjustment='"+c[0]+"' data-member_adjustment='"+h+"'><td>"+a+"</td><td>"+p+"</td><td>"+n+"</td><td>"+h+"</td><td>"+b+"</td><td><span  class='glyphicon glyphicon-remove-sign removeItem'></span></td></tr>").prependTo("#cart tbody"),t.select2("val",null),$("#qty").val(""),o(),l(),$(".loading").hide()},error:function(){$(".loading").hide(),alert("It seems like you have a very slow internet connection.")}})}else t.select2("val",null),alertify.alert("Please complete the form")}),$("#sales_type").select2({placeholder:"Select Sales Type",allowClear:!0}),$("#agent_id").select2({placeholder:"Select Agent",allowClear:!0}),$("#member_id").select2({placeholder:"Search Member",allowClear:!0,minimumInputLength:2,ajax:{url:"../ajax/ajax_json.php",dataType:"json",type:"POST",quietMillis:50,data:function(t){return{q:t,functionName:"members"}},results:function(t){return{results:$.map(t,function(t){return{text:t.lastname+", "+t.sales_type_name,slug:t.lastname+", "+t.firstname+" "+t.middlename,address:t.personal_address,id:t.id}})}}}}),$("body").on("change","#member_id",function(){s(localStorage.company_id,$(this).val()),E()}),$("#custom_date_sold").datepicker({autoclose:!0}).on("changeDate",function(t){$("#custom_date_sold").datepicker("hide")}),r(localStorage.terminal_id),i(),Y(),V(),$("#con_member").select2({placeholder:"Choose member name...",allowClear:!0}).on("select2-open",function(){}).on("select2-close",function(t){setTimeout(function(){$(".select2-container-active").removeClass("select2-container-active"),$(":focus").blur()},100)}),$("#con_member_freebies").select2({placeholder:"Choose member name...",allowClear:!0}).on("select2-open",function(){}).on("select2-close",function(t){setTimeout(function(){$(".select2-container-active").removeClass("select2-container-active"),$(":focus").blur()},100)}),$("#member_credit").select2({placeholder:"Choose member name...",allowClear:!0}),$("#member_deduction").select2({placeholder:"Choose member name...",allowClear:!0}),$(".cashreceivecancel").click(function(){$("#getpricemodal").modal("hide"),$("#credit_table").find("tr").remove(),$("#bt_table").find("tr").remove(),$("#ch_table").find("tr").remove(),$("#tab_d :input[type='text']").val(""),$("#tab_c :input[type='text']").val(""),$("#tab_b :input[type='text']").val(""),$("#tab_a :input[type='text']").val(""),localStorage.removeItem("payment_cheque"),localStorage.removeItem("payment_credit"),localStorage.removeItem("payment_bt"),localStorage.removeItem("payment_cash"),localStorage.removeItem("payment_con"),localStorage.removeItem("payment_con_freebies"),localStorage.removeItem("payment_member_credit"),localStorage.removeItem("payment_member_deduction"),localStorage.removeItem("op_payment_cheque"),localStorage.removeItem("op_payment_credit"),localStorage.removeItem("op_payment_bt"),localStorage.removeItem("op_payment_cash")}),$("body").on("click",".cashreceiveok",function(){d()}),$("#ch_date").datepicker({autoclose:!0}).on("changeDate",function(t){$("#ch_date").datepicker("hide")}),$("#billing_date").datepicker({autoclose:!0}).on("changeDate",function(t){$("#billing_date").datepicker("hide")}),$("#bt_date").datepicker({autoclose:!0}).on("changeDate",function(t){$("#bt_date").datepicker("hide")}),$("#billing_firstname, #billing_middlename, #billing_lastname, #billing_company, #billing_address, #billing_postal,#billing_phone,#billing_email,#billing_remarks").keyup(function(){g($(this))}),$("#bt_bankto_name, #bt_bankto_account_number, #bt_firstname, #bt_middlename, #bt_lastname, #bt_company,#bt_address,#bt_postal,#bt_phone").keyup(function(){x($(this))}),$("#ch_firstname, #ch_middlename, #ch_lastname, #ch_phone").keyup(function(){w($(this))}),$("#cashreceivetext").keypress(function(t){var e=t.which;13==e&&(d(),$("#cashreceivetext").val(""),$("#getpricemodal").modal("hide"))}),$("#cashreceivetext").keyup(function(t){isNaN($(this).val())&&(showToast("error","<p>Please Enter Valid Amount</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).val(""),$(this).focus()),$("#hidcashpayment").val($(this).val()),c()}),$("#addcreditcard").click(function(){var t=$("#billing_cardnumber").val(),e=$("#billing_bankname").val(),a=$("#billing_amount").val();return t||(t="N/A"),a?isNaN(a)?void showToast("error","<p>Please indicate a valid amount</p>","<h3>WARNING!</h3>","toast-bottom-right"):e?S(a,!0)?void showToast("error","<p>Your payment exceeds to amount due.</p>","<h3>WARNING!</h3>","toast-bottom-right"):($("#credit_table").append("<tr><td>"+t+"</td><td>"+a+"</td><td>"+e+"</td><td><span  class='glyphicon glyphicon-remove-sign removeItem'></span></td></tr>"),$("#billing_cardnumber").val(""),$("#billing_bankname").val(""),$("#billing_amount").val(""),void _()):void showToast("error","<p>Please indicate bank name</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate amount</p>","<h3>WARNING!</h3>","toast-bottom-right")}),$("#addbanktransfer").click(function(){var t=$("#bankfrom_account_number").val(),e=$("#bankfrom_name").val(),a=$("#bt_amount").val();return t?a?isNaN(a)?void showToast("error","<p>Please indicate a valid amount</p>","<h3>WARNING!</h3>","toast-bottom-right"):parseFloat(a)<1?void showToast("error","<p>Amount should be greater than Zero</p>","<h3>WARNING!</h3>","toast-bottom-right"):e?S(a,!0)?void showToast("error","<p>Your payment exceeds to amount due.</p>","<h3>WARNING!</h3>","toast-bottom-right"):($("#bt_table").append("<tr><td>"+t+"</td><td>"+a+"</td><td>"+e+"</td><td><span  class='glyphicon glyphicon-remove-sign removeItem'></span></td></tr>"),$("#bankfrom_account_number").val(""),$("#bankfrom_name").val(""),$("#bt_amount").val(""),void y()):void showToast("error","<p>Please indicate bank name</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate amount</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate card number</p>","<h3>WARNING!</h3>","toast-bottom-right")}),$("#addcheque").click(function(){var t=$("#ch_date").val(),e=$("#ch_number").val(),a=$("#ch_amount").val(),o=$("#ch_bankname").val();return t?e?a?A(t)?isNaN(a)?void showToast("error","<p>Please indicate a valid amount</p>","<h3>WARNING!</h3>","toast-bottom-right"):parseFloat(a)<1?void showToast("error","<p>Amount should be greater than Zero</p>","<h3>WARNING!</h3>","toast-bottom-right"):o?S(a,!0)?void showToast("error","<p>Your payment exceeds to amount due.</p>","<h3>WARNING!</h3>","toast-bottom-right"):($("#ch_table").append("<tr><td>"+t+"</td><td>"+e+"</td><td>"+a+"</td><td>"+o+"</td><td><span  class='glyphicon glyphicon-remove-sign removeItem'></span></td></tr>"),$("#ch_date").val(""),$("#ch_number").val(""),$("#ch_amount").val(""),$("#ch_bankname").val(""),void u()):void showToast("error","<p>Please indicate bank name</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Invalid Date Format. It should be mm/dd/yyyy (Ex. 01/01/2014) </p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate amount</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate card number</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate date</p>","<h3>WARNING!</h3>","toast-bottom-right")}),$("#con_amount_freebies").keyup(function(t){if(!$("#con_member_freebies").val())return void showToast("error","<p>Please Choose member first</p>","<h3>WARNING!</h3>","toast-bottom-right");var e=$("#con_member_freebies option:selected").attr("data-con_freebies"),a=parseFloat(localStorage.totalforfreebies);parseFloat($(this).val())>a&&(showToast("error","<p>Invalid freebies amount</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).focus(),$(this).val("")),parseFloat(e)<parseFloat($(this).val())&&(showToast("error","<p>Invalid freebies amount</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).focus(),$(this).val("")),isNaN($(this).val())&&(showToast("error","<p>Please Enter Valid Amount</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).val(""),$(this).focus()),$("#hidconsumablepaymentfreebies").val($(this).val()),S($(this).val(),!1)&&(showToast("error","<p>Your payment exceeds to amount due.</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).val("")),$("#hidconsumablepaymentfreebies").val($(this).val()),f()}),$("#member_credit_amount").keyup(function(t){return $("#member_credit").val()?(isNaN($(this).val())&&(showToast("error","<p>Please Enter Valid Amount</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).val(""),$(this).focus()),$("#hidmembercredit").val($(this).val()),S($(this).val(),!1)&&(showToast("error","<p>Your payment exceeds to amount due.</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).val("")),$("#hidmembercredit").val($(this).val()),void b()):(showToast("error","<p>Please Choose member first</p>","<h3>WARNING!</h3>","toast-bottom-right"),void $(this).val(""))}),$("#member_deduction_amount").keyup(function(t){return $("#member_deduction").val()?(isNaN($(this).val())&&(showToast("error","<p>Please Enter Valid Amount</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).val(""),$(this).focus()),$("#hidmemberdeduction").val($(this).val()),S($(this).val(),!1)&&(showToast("error","<p>Your payment exceeds to amount due.</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).val("")),$("#hidmemberdeduction").val($(this).val()),void v()):(showToast("error","<p>Please Choose member first</p>","<h3>WARNING!</h3>","toast-bottom-right"),void $(this).val(""))}),$("#con_amount").keyup(function(t){if(!$("#con_member").val())return void showToast("error","<p>Please Choose member first</p>","<h3>WARNING!</h3>","toast-bottom-right");if(1==localStorage.hasType2){var e=$("#con_member option:selected").text(),a=$("#con_member").val();removeMemberDetails(),$("#membersIdHelper").append("Member Id: "),$("#memberId").append(a),$("#membersnameHelper").append("Name: "),$("#membersname").append(e),localStorage.removeItem("temp_item_holder")}var o=$("#con_member option:selected").attr("data-con");parseFloat(o)<parseFloat($(this).val())&&(showToast("error","<p>Invalid consumable amount</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).focus(),$(this).val("")),isNaN($(this).val())&&(showToast("error","<p>Please Enter Valid Amount</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).val(""),$(this).focus()),$("#hidconsumablepayment").val($(this).val()),S($(this).val(),!1)&&(showToast("error","<p>Your payment exceeds to amount due.</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).val("")),$("#hidconsumablepayment").val($(this).val()),h()}),$("body").on("click","#checkout",function(){var t=$("#grandtotalholder").text(),e=$("#member_id").val();$("#con_member_freebies").select2("val",e),$("#member_credit").select2("val",e),$("#con_member").select2("val",e),$("#member_deduction").select2("val",e),$("#con_member_freebies").attr("disabled",!0),$("#member_credit").attr("disabled",!0),$("#con_member").attr("disabled",!0),$("#member_deduction").attr("disabled",!0),q("0",t.toString())}),$("body").on("click","#print",function(){if("0"!=$("#cashreceiveholder").text()){var t=$(this),e=t.html();t.html("Loading..."),t.attr("disabled",!0);var a=$("#cart tbody tr").length,o=localStorage.invoice_limit,l=localStorage.dr_limit,n=localStorage.ir_limit,i=[],r=1,s=1,d=1;if($("input[name='checkType']:checked").each(function(){1==$(this).val()&&(s=parseFloat(a)/parseFloat(o),s=Math.ceil(s)),2==$(this).val()&&(r=parseFloat(a)/parseFloat(l),r=Math.ceil(r)),3==$(this).val()&&(d=parseFloat(a)/parseFloat(n),d=Math.ceil(d)),i.push($(this).val())}),!o)return alert("Please add limit items per "+st+" in manage terminal page first."),t.html(e),void t.attr("disabled",!1);if(!l)return alert("Please add limit items per "+dt+" in manage terminal page first."),t.html(e),void t.attr("disabled",!1);if(!n)return alert("Please add limit items per "+pt+" in manage terminal page first."),t.html(e),void t.attr("disabled",!1);if(r>1&&!confirm("This transaction will have "+r+" "+dt+"'s"))return t.html(e),void t.attr("disabled",!1);if(s>1&&!confirm("This transaction will have "+s+" "+st+"s"))return t.html(e),void t.attr("disabled",!1);if(d>1&&!confirm("This transaction will have "+d+" "+pt+"'s"))return t.html(e),void t.attr("disabled",!1);a?(j(i,o,l,n),localStorage.news_print&&1==localStorage.news_print&&D(l)):(showToast("error","<p>No items in cart</p>","<h3>WARNING!</h3>","toast-bottom-right"),t.html(e),t.attr("disabled",!1)),P()}else alertify.alert("Please receive payment yet.")}),E();var mt=null,ct="apollo_db",ht=1;H(),$("body").on("click","#btnSync",function(){var t=$(this);button_action.start_loading(t),$.ajax({url:"../ajax/ajax_json.php",type:"POST",dataType:"json",data:{functionName:"allItems"},success:function(e){if(e.length){for(var a in e)U(e[a]);button_action.end_loading(t)}},error:function(){}})}),localStorage.removeItem("scan"),K();$("body").on("click","#btnOverPayment",function(){localStorage.removeItem("op_payment_cheque"),localStorage.removeItem("op_payment_credit"),localStorage.removeItem("op_payment_bt"),localStorage.removeItem("op_payment_cash"),et(),tt(),at(),ot(),$("#op_label_holder").hide(),$("#modalOverPayment").modal("show")}),$("#op_cashreceivetext").keyup(function(t){isNaN($(this).val())&&(showToast("error","<p>Please Enter Valid Amount</p>","<h3>WARNING!</h3>","toast-bottom-right"),$(this).val(""),$(this).focus()),$("#op_hidcashpayment").val($(this).val()),tt()}),$("#op_addcreditcard").click(function(){var t=$("#op_billing_cardnumber").val(),e=$("#op_billing_bankname").val(),a=$("#op_billing_amount").val();return t||(t="N/A"),a?isNaN(a)?void showToast("error","<p>Please indicate a valid amount</p>","<h3>WARNING!</h3>","toast-bottom-right"):e?S(a,!0)?void showToast("error","<p>Your payment exceeds to amount due.</p>","<h3>WARNING!</h3>","toast-bottom-right"):($("#op_credit_table").append("<tr><td>"+t+"</td><td>"+a+"</td><td>"+e+"</td><td><span  class='glyphicon glyphicon-remove-sign removeItem'></span></td></tr>"),$("#op_billing_cardnumber").val(""),$("#op_billing_bankname").val(""),$("#op_billing_amount").val(""),void et()):void showToast("error","<p>Please indicate bank name</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate amount</p>","<h3>WARNING!</h3>","toast-bottom-right")}),$("#op_addbanktransfer").click(function(){var t=$("#op_bankfrom_account_number").val(),e=$("#op_bankfrom_name").val(),a=$("#op_bt_amount").val();return t?a?isNaN(a)?void showToast("error","<p>Please indicate a valid amount</p>","<h3>WARNING!</h3>","toast-bottom-right"):parseFloat(a)<1?void showToast("error","<p>Amount should be greater than Zero</p>","<h3>WARNING!</h3>","toast-bottom-right"):e?S(a,!0)?void showToast("error","<p>Your payment exceeds to amount due.</p>","<h3>WARNING!</h3>","toast-bottom-right"):($("#op_bt_table").append("<tr><td>"+t+"</td><td>"+a+"</td><td>"+e+"</td><td><span  class='glyphicon glyphicon-remove-sign removeItem'></span></td></tr>"),$("#op_bankfrom_account_number").val(""),$("#op_bankfrom_name").val(""),$("#op_bt_amount").val(""),void at()):void showToast("error","<p>Please indicate bank name</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate amount</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate card number</p>","<h3>WARNING!</h3>","toast-bottom-right")}),$("#op_addcheque").click(function(){var t=$("#op_ch_date").val(),e=$("#op_ch_number").val(),a=$("#op_ch_amount").val(),o=$("#op_ch_bankname").val();return t?e?a?A(t)?isNaN(a)?void showToast("error","<p>Please indicate a valid amount</p>","<h3>WARNING!</h3>","toast-bottom-right"):parseFloat(a)<1?void showToast("error","<p>Amount should be greater than Zero</p>","<h3>WARNING!</h3>","toast-bottom-right"):o?S(a,!0)?void showToast("error","<p>Your payment exceeds to amount due.</p>","<h3>WARNING!</h3>","toast-bottom-right"):($("#op_ch_table").append("<tr><td>"+t+"</td><td>"+e+"</td><td>"+a+"</td><td>"+o+"</td><td><span  class='glyphicon glyphicon-remove-sign removeItem'></span></td></tr>"),$("#op_ch_date").val(""),$("#op_ch_number").val(""),$("#op_ch_amount").val(""),$("#op_ch_bankname").val(""),void ot()):void showToast("error","<p>Please indicate bank name</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Invalid Date Format. It should be mm/dd/yyyy (Ex. 01/01/2014) </p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate amount</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate card number</p>","<h3>WARNING!</h3>","toast-bottom-right"):void showToast("error","<p>Please indicate date</p>","<h3>WARNING!</h3>","toast-bottom-right")}),$(".op_cashreceivecancel").click(function(){$("#modalOverPayment").modal("hide"),$("#op_credit_table").find("tr").remove(),$("#op_bt_table").find("tr").remove(),$("#op_ch_table").find("tr").remove(),$("#over_payment_a :input[type='text']").val(""),$("#over_payment_b :input[type='text']").val(""),$("#over_payment_c :input[type='text']").val(""),$("#over_payment_d :input[type='text']").val(""),localStorage.removeItem("payment_cheque"),localStorage.removeItem("payment_credit"),localStorage.removeItem("payment_bt"),localStorage.removeItem("payment_cash"),localStorage.removeItem("payment_con"),localStorage.removeItem("payment_con_freebies"),localStorage.removeItem("payment_member_credit"),localStorage.removeItem("payment_member_deduction"),localStorage.removeItem("op_payment_cheque"),localStorage.removeItem("op_payment_credit"),localStorage.removeItem("op_payment_bt"),localStorage.removeItem("op_payment_cash")}),$("body").on("click",".op_cashreceiveok",function(){rt()}),$("body").on("click","#use_user_overpayment",function(){var t=JSON.parse($("#op_member_list").val());t.length>0&&$("#use_user_overpayment").show();var e="";for(var a in t)if(console.log(t[a]),1==t[a].status)e+="<div class='panel panel-default'>",e+="<div class='panel-body'>",e+="<p>Type: Cash</p>",e+="<p>Total: "+t[a].json_data+"</p>",e+="<p><input data-status='1' data-id='"+t[a].id+"' value='"+t[a].id+"' data-total='"+t[a].json_data+"' type='checkbox' class='chk_overpayment' > Use Payment</p>",e+="</div>",e+="</div>";else if(2==t[a].status){e+="<div class='panel panel-default'>",e+="<div class='panel-body'>",e+="<p>Type: Credit Card</p>";var o=JSON.parse(t[a].json_data),l=0;for(var n in o)e+="<p>Card: "+o[n].card_type+"</p>",e+="<p>Trance Number: "+o[n].trace_number+"</p>",e+="<p>Date: "+o[n].date+"</p>",e+="<p>Amount: "+o[n].amount+"</p>",e+="<hr>",l+=parseFloat(l)+parseFloat(o[n].amount);e+="<p>Total: "+l+"</p>",e+="<p><input data-json='"+JSON.stringify(t[a])+"' value='"+t[a].id+"' data-status='2' data-id='"+t[a].id+"' data-total='"+l+"' type='checkbox' class='chk_overpayment' > Use Payment</p>",e+="</div>",e+="</div>"}else if(3==t[a].status){e+="<div class='panel panel-default'>",e+="<div class='panel-body'>",e+="<p>Type: Check</p>";var i=JSON.parse(t[a].json_data),r=0;for(var n in i)e+="<p>Ctrl#: "+i[n].cheque_number+"</p>",e+="<p>Date: "+i[n].date+"</p>",e+="<p>Amount: "+i[n].amount+"</p>",e+="<hr>",r=parseFloat(r)+parseFloat(i[n].amount);e+="<p>Total: "+r+"</p>",e+="<p><input data-json='"+JSON.stringify(t[a])+"' value='"+t[a].id+"'  data-status='3' data-id='"+t[a].id+"' data-total='"+r+"' type='checkbox' class='chk_overpayment' > Use Payment</p>",e+="</div>",e+="</div>"}else if(4==t[a].status){e+="<div class='panel panel-default'>",e+="<div class='panel-body'>",e+="<p>Type: Bank Transfer</p>";var s=JSON.parse(t[a].json_data),d=0;for(var n in s)e+="<p>Date: "+s[n].date+"</p>",e+="<p>Amount: "+s[n].amount+"</p>";e+="<p>Total: "+d+"</p>",e+="<p><input data-status='4' data-id='"+t[a].id+"' value='"+t[a].id+"' data-total='"+d+"' type='checkbox' class='chk_overpayment' > Use Payment</p>",e+="</div>",e+="</div>"}$("#right-pane-container").html(e),$(".right-panel-pane").fadeIn(100)}),$("body").on("click",".chk_overpayment",function(){var t=$(this),e=t.attr("data-status"),a=t.attr("data-total"),o=t.is(":checked");if(1==e){var l=$("#cashreceivetext"),n=l.val();n=n?n:0,o?(l.val(parseFloat(n)+parseFloat(a)),$("#hidcashpayment").val(parseFloat(n)+parseFloat(a))):(l.val(parseFloat(n)-parseFloat(a)),$("#hidcashpayment").val(parseFloat(n)-parseFloat(a))),c()}else if(2==e){var i=JSON.parse(t.attr("data-json")),r=JSON.parse(i.json_data),s=$("#billing_card_type"),d=$("#billing_trace_number"),p=$("#billing_approval_code"),m=$("#billing_date");for(var h in r)o?($("#credit_table").append("<tr id='from_user_credit_credit"+r[h].id+"' ><td>"+r[h].credit_number+"</td><td>"+r[h].amount+"</td><td>"+r[h].bank_name+"</td><td></td></tr>"),s.val(r[h].card_type),d.val(r[h].trace_number),p.val(r[h].approval_code),m.val(r[h].date)):$("#from_user_credit_credit"+r[h].id).remove();_()}else if(3==e){var i=JSON.parse(t.attr("data-json")),b=JSON.parse(i.json_data),v=$("#ch_firstname"),f=$("#ch_middlename"),y=$("#ch_lastname"),g=$("#ch_phone");for(var h in b)o?($("#ch_table").append("<tr id='from_user_credit_check"+b[h].id+"' ><td>"+b[h].date+"</td><td>"+b[h].cheque_number+"</td><td>"+b[h].amount+"</td><td>"+b[h].bank_name+"</td><td></td></tr>"),v.val(b[h].firstname),f.val(b[h].middlename),y.val(b[h].lastname),g.val(b[h].phone)):$("#from_user_credit_check"+b[h].id).remove();u()}}),$("body").on("click",".btnReuse",function(){var t=$(this).attr("data-id");$("#member_id").val();$.ajax({url:"../ajax/ajax_sales_query.php",type:"POST",data:{functionName:"getPrevListItem",id:t},success:function(t){$(t).prependTo("#cart tbody"),o(),l()},error:function(){}})})});